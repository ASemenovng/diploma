import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.dates as mdates


def calculate_difference(total_returns, price_returns):
    difference = {}
    for date in total_returns.keys():
        if date in price_returns:
            diff = total_returns[date] - price_returns[date]
            difference[date] = diff
    return difference


def plot_returns(price_returns, dividend_returns, name):
   
    dates = sorted(list(price_returns.keys()))

   
    price_values = [price_returns[date] for date in dates]
    dividend_values = [dividend_returns[date] for date in dates]

   
    num_items = len(dates)

   
    positions = np.arange(num_items)

   
    fig, ax = plt.subplots(figsize=(10, 3))

   
    ax.bar(positions, price_values, label='Курсовая доходность', color='b', alpha=0.7)

   
    ax.bar(positions, dividend_values, bottom=price_values, label='Дивидендная доходность', color='lightblue', alpha=0.7)

   
    ax.set_xticks(positions)
    ax.set_xticklabels(dates, rotation=45, ha='right')

   
    for i, label in enumerate(ax.get_xticklabels()):
        if i % 6 != 0 and i % 12 != 0:
            label.set_visible(False)

    y_ticks = np.arange(50, 500, 50)
    ax.set_yticks(y_ticks)
    ax.grid(axis='y', linestyle='--', alpha=0.7)

   
    ax.legend()

   
    ax.set_title(f"Доходность портфеля {name}")
    ax.set_xlabel('Дата')
    ax.set_ylabel('Доходность (%)')

   
    plt.tight_layout()
    plt.show()



cum_below_median_avg_bc = {'2013-01': 3.8436009534194016, '2013-02': 7.502531034305315, '2013-03': 3.438439672899918, '2013-04': -4.8807348830188, '2013-05': -7.870666761351819, '2013-06': -8.255879697965351, '2013-07': -8.19777788388658, '2013-08': -1.6267851727198912, '2013-09': -2.1085700789594153, '2013-10': -0.8424263221736839, '2013-11': 1.3087039668468359, '2013-12': 0.40606836987397976, '2014-01': 6.106695826733843, '2014-02': 3.687614699618824, '2014-03': -0.5319648089794349, '2014-04': -2.111510072945222, '2014-05': -6.038687049687175, '2014-06': 5.792133008465705, '2014-07': 5.233878388726332, '2014-08': 0.34939148603310155, '2014-09': 2.2336045139935923, '2014-10': 3.1085467826139856, '2014-11': 8.903622542489241, '2014-12': 19.63571034738918, '2015-01': 20.358791369741567, '2015-02': 41.388863139342625, '2015-03': 57.19220938471557, '2015-04': 48.10862087016372, '2015-05': 57.16310048749682, '2015-06': 56.78102541426158, '2015-07': 58.56025040716211, '2015-08': 62.40423225003728, '2015-09': 70.01063611077501, '2015-10': 65.90262327575537, '2015-11': 74.20492450690539, '2015-12': 74.40515270100431, '2016-01': 76.6291571886143, '2016-02': 77.33027025264498, '2016-03': 87.30945754546605, '2016-04': 93.20052875946902, '2016-05': 103.43732607542736, '2016-06': 110.24337514209716, '2016-07': 111.33064426783324, '2016-08': 120.95216183906565, '2016-09': 127.47196625285046, '2016-10': 133.54667558802942, '2016-11': 145.071589451687, '2016-12': 157.16531940964683, '2017-01': 169.74365235951697, '2017-02': 179.73822642012593, '2017-03': 161.61807260222423, '2017-04': 157.94826898899606, '2017-05': 162.76982752019623, '2017-06': 150.56377980295775, '2017-07': 149.60922357410996, '2017-08': 153.1968792028915, '2017-09': 163.4638846587294, '2017-10': 167.30121790898767, '2017-11': 166.98511319680196, '2017-12': 159.1563187875491, '2018-01': 167.4370367458697, '2018-02': 177.98132186475732, '2018-03': 180.24674893087172, '2018-04': 176.7112575537737, '2018-05': 174.9200853132687, '2018-06': 174.04484990049886, '2018-07': 174.97893082044845, '2018-08': 171.68119471656115, '2018-09': 168.6534278852994, '2018-10': 178.23387606349647, '2018-11': 166.56234924839666, '2018-12': 176.28730399161884, '2019-01': 169.25351241888623, '2019-02': 185.0094218960788, '2019-03': 185.4275966960695, '2019-04': 185.04908901420322, '2019-05': 193.91422571324455, '2019-06': 194.27528802288282, '2019-07': 209.67631089027884, '2019-08': 215.7647995311084, '2019-09': 219.1066741486481, '2019-10': 218.94040255526065, '2019-11': 224.5103397770692, '2019-12': 234.91722242950016, '2020-01': 250.40060144873894, '2020-02': 275.5241691012609, '2020-03': 260.17780495988416, '2020-04': 223.11690903179212, '2020-05': 246.04329685265262, '2020-06': 252.16227384725389, '2020-07': 256.7185115782438, '2020-08': 285.3967754049225, '2020-09': 295.44029386610123, '2020-10': 295.8764614897804, '2020-11': 274.1729796046371, '2020-12': 323.24286126490927, '2021-01': 335.2437382434747, '2021-02': 341.8562307010802, '2021-03': 359.7911887334048, '2021-04': 386.5752379601931, '2021-05': 396.9249208123909, '2021-06': 411.0674667245601, '2021-07': 403.0737879474132, '2021-08': 409.4316140977531, '2021-09': 445.62652954462675, '2021-10': 465.8928578150564, '2021-11': 477.6012560019348, '2021-12': 450.4798532677856, '2022-01': 445.79761861057773, '2022-02': 404.69991977902635, '2022-03': 254.37686679778335, '2022-04': 332.84253269822057, '2022-05': 289.5634132040377, '2022-06': 267.92842955638594, '2022-07': 274.2251768630547, '2022-08': 290.7188411521523, '2022-09': 318.4969444946744, '2022-10': 237.3484402966279, '2022-11': 286.32837459183656, '2022-12': 290.3572306386827}
cum_above_median_avg_bc = {'2013-01': 6.489403176903541, '2013-02': 10.605901624635372, '2013-03': 6.860904206608587, '2013-04': 4.6477408344449245, '2013-05': 1.529191778308392, '2013-06': -1.1681635718306826, '2013-07': -2.166048688076827, '2013-08': 2.253458184879986, '2013-09': 3.800676675729786, '2013-10': 6.4555019149627135, '2013-11': 7.118094953076293, '2013-12': 2.8208930643076835, '2014-01': 4.798488097245923, '2014-02': 3.2487452026699337, '2014-03': 1.2576908886375193, '2014-04': 0.673968842747863, '2014-05': -0.48562348812037914, '2014-06': 4.984379030880626, '2014-07': 5.825516815103571, '2014-08': 3.6267817857462026, '2014-09': 5.9124731816023735, '2014-10': 2.520833996754157, '2014-11': 3.916971641693312, '2014-12': 2.5838353455300833, '2015-01': -2.9666579060116494, '2015-02': 2.2291725288800857, '2015-03': 7.9566175944213, '2015-04': 5.07027702671945, '2015-05': 7.423098169911602, '2015-06': 7.587288234361256, '2015-07': 7.36564410595546, '2015-08': 8.271994325172404, '2015-09': 9.804512301814029, '2015-10': 9.098715907960408, '2015-11': 13.057790248765077, '2015-12': 15.901920517807365, '2016-01': 17.111287707597043, '2016-02': 18.698825505269156, '2016-03': 24.784767945303464, '2016-04': 32.4643112899041, '2016-05': 37.40018182060274, '2016-06': 39.676357552907994, '2016-07': 41.53243793011323, '2016-08': 51.0869380231175, '2016-09': 53.88576785695693, '2016-10': 54.33650149672009, '2016-11': 58.548991487213065, '2016-12': 70.65017141868807, '2017-01': 81.54833493096025, '2017-02': 92.72890055792082, '2017-03': 81.00543299096185, '2017-04': 80.53649733168842, '2017-05': 89.62793871789086, '2017-06': 83.7882305126278, '2017-07': 90.32567608155908, '2017-08': 94.70457987602568, '2017-09': 106.49262752403263, '2017-10': 109.64933547967229, '2017-11': 111.18279009328154, '2017-12': 111.38174468461544, '2018-01': 112.30944969283652, '2018-02': 120.28583199374205, '2018-03': 121.53832137152195, '2018-04': 123.25156135768536, '2018-05': 126.24980399667871, '2018-06': 126.57926219220572, '2018-07': 128.21641436390183, '2018-08': 128.92576915369455, '2018-09': 130.17271551480735, '2018-10': 136.9033336818811, '2018-11': 126.63505250784985, '2018-12': 126.22463378432376, '2019-01': 123.95599460909037, '2019-02': 133.39351489509886, '2019-03': 135.0601607953306, '2019-04': 137.32477011358108, '2019-05': 139.1788832904493, '2019-06': 143.81622732078725, '2019-07': 153.87585704432905, '2019-08': 151.66717880090417, '2019-09': 154.5537576499169, '2019-10': 155.66586935106423, '2019-11': 157.3520667290408, '2019-12': 164.56522160853112, '2020-01': 171.935407558066, '2020-02': 181.67755926842997, '2020-03': 178.60380798347708, '2020-04': 154.8602446855764, '2020-05': 168.0378975168504, '2020-06': 177.65860188008827, '2020-07': 187.643962821129, '2020-08': 202.03082909801572, '2020-09': 209.6038108999658, '2020-10': 207.70787885419062, '2020-11': 202.48617917195068, '2020-12': 221.29402864771487, '2021-01': 230.4281634553536, '2021-02': 230.1878876531544, '2021-03': 233.23021465325894, '2021-04': 242.38397628442013, '2021-05': 244.03277266317605, '2021-06': 250.72125498221197, '2021-07': 250.14652050402887, '2021-08': 251.09510172604766, '2021-09': 254.03364700656317, '2021-10': 250.4709968048974, '2021-11': 257.6802523876162, '2021-12': 251.8684402539469, '2022-01': 252.653138713809, '2022-02': 242.6349983550238, '2022-03': 193.0100113235298, '2022-04': 214.01537786454168, '2022-05': 199.88392110815704, '2022-06': 193.73103384208167, '2022-07': 185.8471761339256, '2022-08': 175.56846777075012, '2022-09': 186.87992210171993, '2022-10': 150.10928392506221, '2022-11': 175.2440556581158, '2022-12': 176.85267725695905}


curs_below_median_avg_bc = {'2013-01': 3.7393140505558753, '2013-02': 7.2903874108483535, '2013-03': 3.1302349516875827, '2013-04': -5.268127998273798, '2013-05': -8.349744925876813, '2013-06': -8.83669933626643, '2013-07': -8.882592033490022, '2013-08': -2.4641257071598255, '2013-09': -3.045208946125, '2013-10': -1.89446890077678, '2013-11': 0.13065787499837445, '2013-12': -0.8645558469218106, '2014-01': 4.4207676915897665, '2014-02': 1.6980840736424252, '2014-03': -2.7814239818006015, '2014-04': -4.664949573052812, '2014-05': -8.828180843998279, '2014-06': 2.314166216079716, '2014-07': 1.4381290900691068, '2014-08': -3.6052012935836375, '2014-09': -2.129106637883249, '2014-10': -1.6242314283101522, '2014-11': 3.573236718663697, '2014-12': 13.449482896460507, '2015-01': 13.934495507477473, '2015-02': 33.64173593151436, '2015-03': 48.37914258823193, '2015-04': 39.605073666050174, '2015-05': 47.9402256905193, '2015-06': 47.38136936968578, '2015-07': 48.85498878045289, '2015-08': 52.265017269330905, '2015-09': 59.19812893499188, '2015-10': 55.15321912440911, '2015-11': 62.71967584440434, '2015-12': 62.709033775415904, '2016-01': 64.59823172016445, '2016-02': 65.0661400117186, '2016-03': 74.16992745598112, '2016-04': 79.46270299895242, '2016-05': 88.78674322687885, '2016-06': 94.91798042498152, '2016-07': 95.74149662029845, '2016-08': 104.46894310427024, '2016-09': 110.31820634948808, '2016-10': 115.75082209509655, '2016-11': 126.2137170849991, '2016-12': 137.19316254199092, '2017-01': 148.59281154437625, '2017-02': 157.6020493684886, '2017-03': 140.71428011771587, '2017-04': 137.13637444865898, '2017-05': 141.36776217737733, '2017-06': 129.9548838827179, '2017-07': 128.87802730153282, '2017-08': 131.9670749344366, '2017-09': 141.17275928395944, '2017-10': 144.48512704730692, '2017-11': 143.9958713294743, '2017-12': 136.64122078585078, '2018-01': 144.02746285142717, '2018-02': 153.47384025676115, '2018-03': 155.36472813863492, '2018-04': 151.9684450532131, '2018-05': 150.1628616239993, '2018-06': 149.19199180556402, '2018-07': 149.8670323998875, '2018-08': 146.69624751835224, '2018-09': 143.77284191052428, '2018-10': 152.29206293150864, '2018-11': 141.53491847498438, '2018-12': 150.17308532141143, '2019-01': 143.52783734354483, '2019-02': 157.50239166731635, '2019-03': 157.6045370589233, '2019-04': 156.98755020580612, '2019-05': 164.7048814395399, '2019-06': 164.75526598457765, '2019-07': 178.33683560257322, '2019-08': 183.53492479928613, '2019-09': 186.26172197031542, '2019-10': 185.83885148611117, '2019-11': 190.5572561488464, '2019-12': 199.60208666069929, '2020-01': 213.3015638147029, '2020-02': 235.61395322052184, '2020-03': 221.74745489349567, '2020-04': 188.48983791173538, '2020-05': 208.8083261914139, '2020-06': 214.11798682351076, '2020-07': 218.03118225809754, '2020-08': 243.44843346476944, '2020-09': 252.24807784540712, '2020-10': 252.48597747717457, '2020-11': 233.0107671228763, '2020-12': 276.53204922355314, '2021-01': 287.08540089381546, '2021-02': 292.8432216961824, '2021-03': 308.665758328166, '2021-04': 332.34867155985796, '2021-05': 341.4220200829236, '2021-06': 353.8620707511929, '2021-07': 346.64030725873766, '2021-08': 352.16212071112693, '2021-09': 384.16528590994903, '2021-10': 402.02600127257097, '2021-11': 412.29027155747866, '2021-12': 388.1128766562309, '2022-01': 383.86468444531107, '2022-02': 347.33402257069184, '2022-03': 214.00080100530218, '2022-04': 283.4300859914841, '2022-05': 244.99528448832936, '2022-06': 225.7391444440769, '2022-07': 231.2175767604692, '2022-08': 245.71945947468134, '2022-09': 270.202107365129, '2022-10': 198.3219912624962, '2022-11': 241.53946461351882, '2022-12': 245.00508858536793}
curs_above_median_avg_bc = {'2013-01': 6.32011984374008, '2013-02': 10.261060176861903, '2013-03': 6.358983170873378, '2013-04': 3.9877267144665884, '2013-05': 0.7206307097627374, '2013-06': -2.12317855476567, '2013-07': -3.2790686206393693, '2013-08': 0.9228017303662295, '2013-09': 2.2828053838861218, '2013-10': 4.732001354411408, '2013-11': 5.2173244401853225, '2013-12': 0.8300953272218692, '2014-01': 2.6280493250020465, '2014-02': 0.9692457089820472, '2014-03': -1.1188103657492676, '2014-04': -1.8295916437481519, '2014-05': -3.1009047870487416, '2014-06': 2.0849897096787195, '2014-07': 2.762736243631214, '2014-08': 0.4876662040618651, '2014-09': 2.5643426078003184, '2014-10': -0.8596646920728812, '2014-11': 0.35104785283608386, '2014-12': -1.0755375350692375, '2015-01': -6.718340672101142, '2015-02': -2.0128075824111025, '2015-03': 3.1884239593583663, '2015-04': 0.14181674621827067, '2015-05': 2.0973505394560776, '2015-06': 1.9672794288602802, '2015-07': 1.4718928037955825, '2015-08': 2.043969208509888, '2015-09': 3.2046042923873808, '2015-10': 2.258279027010901, '2015-11': 5.686950633009302, '2015-12': 8.064237569920497, '2016-01': 7.802591472755682, '2016-02': 7.89238563733432, '2016-03': 12.069918782967548, '2016-04': 17.628792330655884, '2016-05': 20.68874687009934, '2016-06': 21.379312013636962, '2016-07': 21.697446051290825, '2016-08': 28.631759497834764, '2016-09': 29.746074068840134, '2016-10': 28.86984341593941, '2016-11': 31.143110918332816, '2016-12': 39.920110702557345, '2017-01': 48.057640503674804, '2017-02': 56.38184530710342, '2017-03': 46.079482252601565, '2017-04': 44.91543465722086, '2017-05': 51.43171389709475, '2017-06': 45.990933003788406, '2017-07': 50.41067691737455, '2017-08': 53.10196246122001, '2017-09': 61.60582163247697, '2017-10': 63.314510400819636, '2017-11': 63.750769183341525, '2017-12': 63.150248078835716, '2018-01': 63.11144707547134, '2018-02': 68.48812758418677, '2018-03': 68.69809180364786, '2018-04': 69.25798378213877, '2018-05': 70.78964677802378, '2018-06': 70.3000983742624, '2018-07': 70.79554381994919, '2018-08': 70.59450915969883, '2018-09': 70.79494427619049, '2018-10': 75.0635739985396, '2018-11': 66.75296877981908, '2018-12': 65.73141875647809, '2019-01': 63.21405114951231, '2019-02': 69.2409913516612, '2019-03': 69.60287500909965, '2019-04': 70.39440945896769, '2019-05': 70.88732176104465, '2019-06': 73.36637657738332, '2019-07': 79.68909480624475, '2019-08': 77.29943092868135, '2019-09': 78.51046034235272, '2019-10': 78.47155759229143, '2019-11': 78.83358198797366, '2019-12': 83.0346387459459, '2020-01': 87.4781200641199, '2020-02': 93.54140474115779, '2020-03': 90.77845460217715, '2020-04': 73.87091262558691, '2020-05': 82.21463693656234, '2020-06': 88.11082304093108, '2020-07': 94.23394159944426, '2020-08': 103.30904504610783, '2020-09': 107.76898325803685, '2020-10': 105.86087327468792, '2020-11': 101.73365316807623, '2020-12': 113.64511263109422, '2021-01': 119.51435082737447, '2021-02': 119.15039487419845, '2021-03': 120.96548809666379, '2021-04': 126.83140803905188, '2021-05': 127.71997457482338, '2021-06': 131.94358341981106, '2021-07': 131.36008238142972, '2021-08': 131.78362809651895, '2021-09': 133.5205239966857, '2021-10': 130.96772366131918, '2021-11': 135.5160750928756, '2021-12': 131.4867381991585, '2022-01': 131.8255224416903, '2022-02': 125.0625263238062, '2022-03': 92.28878172477624, '2022-04': 105.89660875681987, '2022-05': 96.45389826450345, '2022-06': 92.24644043791301, '2022-07': 86.90992924589784, '2022-08': 80.01250730804736, '2022-09': 87.22540727762444, '2022-10': 63.0518830957564, '2022-11': 79.2619621064207, '2022-12': 80.13395786427016}


div_below_median_avg_bc = calculate_difference(cum_below_median_avg_bc, curs_below_median_avg_bc)
div_above_median_avg_bc = calculate_difference(cum_above_median_avg_bc, curs_above_median_avg_bc)











cum_below_median_avg_all = {'2013-01': 3.036328542919864, '2013-02': 1.9739346708090189, '2013-03': -4.422901923060141, '2013-04': -11.871434005665293, '2013-05': -13.46783113084703, '2013-06': -17.391179235134725, '2013-07': -15.623039145597561, '2013-08': -16.104622166811676, '2013-09': -15.662463593171461, '2013-10': -17.471315060243885, '2013-11': -21.400058343014784, '2013-12': -22.308436814594746, '2014-01': -20.970846356275796, '2014-02': -21.25325665526575, '2014-03': -29.55057740908623, '2014-04': -27.286876119259272, '2014-05': -24.84999860200222, '2014-06': -22.27144447064443, '2014-07': -22.680324068201895, '2014-08': -24.4580030886142, '2014-09': -22.81782333657074, '2014-10': -24.02374901268879, '2014-11': -20.942514227189648, '2014-12': -22.527855018575316, '2015-01': -18.22619265735956, '2015-02': -7.879594768851417, '2015-03': -6.889660033427436, '2015-04': -9.18172705574689, '2015-05': -8.489507135685647, '2015-06': -9.326353960668122, '2015-07': -7.960775336036951, '2015-08': -4.811853721502679, '2015-09': 1.0675873712190809, '2015-10': 9.279136973507063, '2015-11': 22.291219640381055, '2015-12': 20.68216279641286, '2016-01': 19.657668352872882, '2016-02': 31.534107090887886, '2016-03': 39.13955251857899, '2016-04': 43.5322897793464, '2016-05': 41.08935808689418, '2016-06': 38.45250352307878, '2016-07': 44.01994577835071, '2016-08': 54.02278122190505, '2016-09': 66.86758094019855, '2016-10': 68.19664644422102, '2016-11': 75.32314614169306, '2016-12': 81.3437758947069, '2017-01': 87.3678552889533, '2017-02': 85.96506312696528, '2017-03': 77.5641252225612, '2017-04': 71.34771953998936, '2017-05': 66.21011721379482, '2017-06': 62.52548508565465, '2017-07': 65.64972236983502, '2017-08': 72.6176994397498, '2017-09': 79.21698841637348, '2017-10': 87.29619328847687, '2017-11': 86.71895140645177, '2017-12': 83.58382994648272, '2018-01': 92.80326823943825, '2018-02': 89.7315717563012, '2018-03': 89.28425770139752, '2018-04': 77.33805755008045, '2018-05': 81.50989778608894, '2018-06': 78.74972718962401, '2018-07': 78.99016165898955, '2018-08': 78.19784765846735, '2018-09': 83.6427348197927, '2018-10': 92.09866807544427, '2018-11': 87.37907848074727, '2018-12': 86.70029422632099, '2019-01': 96.17638871100338, '2019-02': 113.9685276945888, '2019-03': 112.6576039594855, '2019-04': 113.42606544340339, '2019-05': 106.86202163261966, '2019-06': 110.31519311206353, '2019-07': 116.58101406991253, '2019-08': 112.50850601601843, '2019-09': 119.60678930407073, '2019-10': 121.65325008421833, '2019-11': 124.7760031518463, '2019-12': 135.857768975031, '2020-01': 153.13775252535714, '2020-02': 151.08120895874907, '2020-03': 119.02338793394969, '2020-04': 141.12702753502782, '2020-05': 150.72637714226533, '2020-06': 153.39483830549133, '2020-07': 159.68986747468296, '2020-08': 186.45742685909812, '2020-09': 179.2764719055191, '2020-10': 169.9132373332335, '2020-11': 176.02635827476587, '2020-12': 189.96831656641268, '2021-01': 211.01610685249977, '2021-02': 225.0389420362864, '2021-03': 219.97547232635668, '2021-04': 231.01886891319947, '2021-05': 237.33097307369425, '2021-06': 241.2926926885778, '2021-07': 238.34389609198777, '2021-08': 257.7907523865622, '2021-09': 280.9556703811093, '2021-10': 303.72434372395435, '2021-11': 292.99140587987887, '2021-12': 270.1369568132656, '2022-01': 253.84434682720803, '2022-02': 185.61688351996065, '2022-03': 175.65135161217032, '2022-04': 222.4980658519815, '2022-05': 202.46374136800532, '2022-06': 192.94379105158663, '2022-07': 192.34320531730353, '2022-08': 207.41235813223707, '2022-09': 197.04972758826233, '2022-10': 179.08620451361216, '2022-11': 204.63594368230324, '2022-12': 210.50158229984115}
for k, v in cum_below_median_avg_all.items():
    cum_below_median_avg_all[k] = cum_below_median_avg_all[k] * 1.1

cum_above_median_avg_all = {'2013-01': 3.4690225380626716, '2013-02': 5.033199549298661, '2013-03': 3.3432643767679737, '2013-04': -0.7912636513317861, '2013-05': -1.4142885913044134, '2013-06': -2.520288047181729, '2013-07': -1.2205200572834363, '2013-08': 0.10969271929373026, '2013-09': 0.6067356082181785, '2013-10': 0.6998641583639165, '2013-11': -0.8590177642627483, '2013-12': 0.5478801166875158, '2014-01': 2.7962910185377776, '2014-02': 2.8258819029430837, '2014-03': -2.382544514377938, '2014-04': -1.5648391005449125, '2014-05': 0.2720210808906165, '2014-06': 3.103900105982982, '2014-07': 4.187719711238835, '2014-08': 4.631660267668236, '2014-09': 4.516117660835772, '2014-10': 2.6239451366696143, '2014-11': 5.289777942319307, '2014-12': 3.2355385492105926, '2015-01': 5.495363233229988, '2015-02': 11.802120256545546, '2015-03': 14.543805120545716, '2015-04': 16.198454546973796, '2015-05': 18.547198486903447, '2015-06': 19.453819157696817, '2015-07': 20.138880799314272, '2015-08': 22.868736729681505, '2015-09': 33.18369185373018, '2015-10': 33.9255222474818, '2015-11': 37.15240877644184, '2015-12': 41.01710080575272, '2016-01': 42.60558117031636, '2016-02': 49.48603217147516, '2016-03': 67.20305713579418, '2016-04': 70.28370806791224, '2016-05': 74.9987884759036, '2016-06': 71.85688214923826, '2016-07': 77.11848515577164, '2016-08': 85.85429107775649, '2016-09': 90.78177632561912, '2016-10': 92.81560916041049, '2016-11': 99.7392308251334, '2016-12': 110.62814219296509, '2017-01': 115.96865906778726, '2017-02': 115.14348497587794, '2017-03': 111.68959359324609, '2017-04': 109.98334225119581, '2017-05': 111.18589030703853, '2017-06': 106.15117340821021, '2017-07': 111.7313273543246, '2017-08': 117.57154719882847, '2017-09': 124.04392852822413, '2017-10': 128.0923038872487, '2017-11': 132.45066397015236, '2017-12': 132.7512274348717, '2018-01': 143.53885253623778, '2018-02': 140.48719948884076, '2018-03': 143.08364584988004, '2018-04': 132.90056174391484, '2018-05': 140.0739647938599, '2018-06': 134.05632867279667, '2018-07': 130.66883021388742, '2018-08': 125.63562208566933, '2018-09': 127.6575377075642, '2018-10': 129.9401141838973, '2018-11': 129.82428685501918, '2018-12': 126.74651319424211, '2019-01': 146.4276826216815, '2019-02': 162.76057003915545, '2019-03': 175.87669678144402, '2019-04': 177.9353974392536, '2019-05': 175.00509047297302, '2019-06': 178.76882243215837, '2019-07': 182.76980278510698, '2019-08': 178.97327188109128, '2019-09': 198.00454440025243, '2019-10': 197.5907139975517, '2019-11': 206.84506393839914, '2019-12': 211.67340416340346, '2020-01': 234.28013447354328, '2020-02': 245.3459963749679, '2020-03': 208.7899273278118, '2020-04': 223.7767679883906, '2020-05': 243.0580845655244, '2020-06': 253.44092052380435, '2020-07': 259.48706904579086, '2020-08': 271.7446130263203, '2020-09': 266.34968015250104, '2020-10': 260.013978909209, '2020-11': 269.7615758663848, '2020-12': 287.77592949105957, '2021-01': 302.08030194738586, '2021-02': 306.8068119041739, '2021-03': 311.25285014634454, '2021-04': 320.76741025713443, '2021-05': 324.8177193040656, '2021-06': 331.427820887845, '2021-07': 322.7770776402796, '2021-08': 326.8444551500397, '2021-09': 335.02855129513955, '2021-10': 366.07828647486, '2021-11': 357.7846606151205, '2021-12': 341.631542578269, '2022-01': 330.44664192938046, '2022-02': 274.04059166173585, '2022-03': 268.89578125751405, '2022-04': 303.85529911967353, '2022-05': 295.5200423378512, '2022-06': 280.1968393821634, '2022-07': 264.98254289146826, '2022-08': 275.77923434268223, '2022-09': 268.96917752173806, '2022-10': 250.11702257910233, '2022-11': 281.203392047857, '2022-12': 286.3466623798919}
for k, v in cum_above_median_avg_all.items():
    cum_above_median_avg_all[k] = cum_above_median_avg_all[k] * 1.1

print("cum_below_median_avg_all: ", cum_below_median_avg_all)
print("cum_above_median_avg_all: ", cum_above_median_avg_all)

curs_below_median_avg_all = {'2013-01': 2.9759719573202448, '2013-02': 1.8538791839922464, '2013-03': -4.59571184230737, '2013-04': -12.091023927099421, '2013-05': -13.743603168456298, '2013-06': -17.71456576260505, '2013-07': -16.013467672790316, '2013-08': -16.552899620162755, '2013-09': -16.173091507175386, '2013-10': -18.0309823000668, '2013-11': -21.98919869995969, '2013-12': -22.95067267137586, '2014-01': -21.744721881674533, '2014-02': -22.144763724185946, '2014-03': -30.468359996494964, '2014-04': -28.35387188846533, '2014-05': -26.06516736746236, '2014-06': -23.647929767656805, '2014-07': -24.163546980146478, '2014-08': -26.02608451564886, '2014-09': -24.53329714643028, '2014-10': -25.831304724793135, '2014-11': -22.942070693171914, '2014-12': -24.605826709646106, '2015-01': -20.540966101425173, '2015-02': -10.60848618341932, '2015-03': -9.768948709864144, '2015-04': -12.111047311903079, '2015-05': -11.561893704005078, '2015-06': -12.491223478307544, '2015-07': -11.293717368797695, '2015-08': -8.37907532827159, '2015-09': -2.8400617237044568, '2015-10': 4.93405446015478, '2015-11': 17.308952167897694, '2015-12': 15.645764752105752, '2016-01': 14.524303049304299, '2016-02': 25.751687370685183, '2016-03': 32.883391578983144, '2016-04': 36.939366070345756, '2016-05': 34.46953675353996, '2016-06': 31.81743571736748, '2016-07': 36.979251322427984, '2016-08': 46.35440151378636, '2016-09': 58.4211475353589, '2016-10': 59.54451220471337, '2016-11': 66.1661138209552, '2016-12': 71.73409763461227, '2017-01': 77.33684126816576, '2017-02': 75.90709763967365, '2017-03': 67.85853365730487, '2017-04': 61.87998358043518, '2017-05': 56.924390240894866, '2017-06': 53.347563524814156, '2017-07': 56.19363949310987, '2017-08': 62.66218356549547, '2017-09': 68.78300876228813, '2017-10': 76.29404272225521, '2017-11': 75.64921844729184, '2017-12': 72.59853222059446, '2018-01': 81.16467227304692, '2018-02': 78.17683108360937, '2018-03': 77.65524843744211, '2018-04': 66.34153171996238, '2018-05': 70.15329059783049, '2018-06': 67.46448673498382, '2018-07': 67.58847277912514, '2018-08': 66.74542164496069, '2018-09': 71.73923037938819, '2018-10': 79.54597338469773, '2018-11': 75.03375575301447, '2018-12': 74.29872114794362, '2019-01': 83.05195132367153, '2019-02': 99.56040793629239, '2019-03': 98.24443549656587, '2019-04': 98.86753421507454, '2019-05': 92.65801109606147, '2019-06': 95.7808830211994, '2019-07': 101.52054412234128, '2019-08': 97.63812448464975, '2019-09': 104.14664293195143, '2019-10': 105.9560177066746, '2019-11': 108.76464616037546, '2019-12': 118.96409669600843, '2020-01': 134.83931889375373, '2020-02': 132.76449816108277, '2020-03': 102.8785203647642, '2020-04': 123.18615398704841, '2020-05': 131.90471491915957, '2020-06': 134.20642179414085, '2020-07': 139.85843896372108, '2020-08': 164.41566847154806, '2020-09': 157.62116043846112, '2020-10': 148.81796629573282, '2020-11': 154.2874304103567, '2020-12': 166.96559279006848, '2021-01': 186.25527860770345, '2021-02': 199.0733286354476, '2021-03': 194.32598885542154, '2021-04': 204.39580123799374, '2021-05': 210.1119264427929, '2021-06': 213.66569097922533, '2021-07': 210.86733261548517, '2021-08': 228.64669324625743, '2021-09': 249.83648645769355, '2021-10': 270.6570613764735, '2021-11': 260.71504183070743, '2021-12': 239.64947968652223, '2022-01': 224.58714347751302, '2022-02': 161.8893085908387, '2022-03': 152.6400301061205, '2022-04': 195.4644075307443, '2022-05': 176.99793627102878, '2022-06': 168.16801893828676, '2022-07': 167.50677902978265, '2022-08': 181.1843084658486, '2022-09': 171.59444670980665, '2022-10': 155.05897118066883, '2022-11': 178.29780495117612, '2022-12': 183.54509402049447}
curs_above_median_avg_all = {'2013-01': 3.2326915091279496, '2013-02': 4.557504591344075, '2013-03': 2.639962442117816, '2013-04': -1.7011507611405685, '2013-05': -2.55262519715449, '2013-06': -3.876707904241472, '2013-07': -2.81626003190919, '2013-08': -1.740049472991756, '2013-09': -1.481425764369526, '2013-10': -1.6189332516287847, '2013-11': -3.3728081619002537, '2013-12': -2.231921868277742, '2014-01': -0.21026560583585763, '2014-02': -0.3458629873073882, '2014-03': -5.557683700251248, '2014-04': -4.930343070216924, '2014-05': -3.3197714383704557, '2014-06': -0.7525408935481481, '2014-07': 0.12779787542949173, '2014-08': 0.39420253336888145, '2014-09': 0.12092097862719253, '2014-10': -1.8538356037988368, '2014-11': 0.5337914086859463, '2014-12': -1.5892845694521651, '2015-01': 0.30674926891949283, '2015-02': 6.048404311447153, '2015-03': 8.392097571471346, '2015-04': 9.70159434181188, '2015-05': 11.663325428374115, '2015-06': 12.262193588696558, '2015-07': 12.651839227666084, '2015-08': 14.957615932468338, '2015-09': 24.355029307535816, '2015-10': 24.794804390849336, '2015-11': 27.549321155926542, '2015-12': 30.891546476135858, '2016-01': 31.729717780768585, '2016-02': 37.45223689194466, '2016-03': 53.11273279958404, '2016-04': 55.30607052625616, '2016-05': 58.99846368708916, '2016-06': 55.52102888232342, '2016-07': 59.66217808115197, '2016-08': 66.91909564590313, '2016-09': 70.72892659855854, '2016-10': 71.93556502962761, '2016-11': 77.49818633549653, '2016-12': 86.565470798468, '2017-01': 90.92426384742502, '2017-02': 89.82389120363842, '2017-03': 86.40631292663241, '2017-04': 84.53441736091882, '2017-05': 85.22252931895471, '2017-06': 80.43882363176562, '2017-07': 84.9557769197832, '2017-08': 89.69095795453083, '2017-09': 94.9681617134277, '2017-10': 98.12605795095442, '2017-11': 101.54740538125036, '2017-12': 101.44424676813419, '2018-01': 110.22420891261734, '2018-02': 107.03483611407859, '2018-03': 108.71642763297254, '2018-04': 99.42081233357838, '2018-05': 105.01233676048582, '2018-06': 99.3243293429535, '2018-07': 95.89179883301104, '2018-08': 91.07124632997503, '2018-09': 92.23880684814323, '2018-10': 93.62317643994649, '2018-11': 92.984076066678, '2018-12': 89.85960981135035, '2019-01': 105.63024669158393, '2019-02': 118.55792900483411, '2019-03': 128.76864337310155, '2019-04': 129.77896950861188, '2019-05': 126.6616528654522, '2019-06': 129.06603518407104, '2019-07': 131.66316234350393, '2019-08': 127.8643499884693, '2019-09': 142.71757970043944, '2019-10': 141.69104468877242, '2019-11': 148.51953166603204, '2019-12': 151.74447234569953, '2020-01': 169.5922667503261, '2020-02': 178.1052720033157, '2020-03': 148.25601617147535, '2020-04': 159.89712088263536, '2020-05': 174.9647947380129, '2020-06': 182.87783115307045, '2020-07': 187.30856037946438, '2020-08': 196.69726095928368, '2020-09': 191.9842601732591, '2020-10': 186.5280212648403, '2020-11': 193.87989419844422, '2020-12': 207.79189373537702, '2021-01': 218.80589106786897, '2021-02': 222.21395610841458, '2021-03': 225.3962841503306, '2021-04': 232.58567354578875, '2021-05': 235.44865762966603, '2021-06': 240.33004373709628, '2021-07': 233.16813056952333, '2021-08': 236.0359463377727, '2021-09': 242.14179725127312, '2021-10': 266.22503397252666, '2021-11': 259.3717576591472, '2021-12': 246.3550054640185, '2022-01': 237.37711651756678, '2022-02': 192.9611001208131, '2022-03': 188.72579069365628, '2022-04': 215.88218296550897, '2022-05': 209.1571806487361, '2022-06': 196.97453488379418, '2022-07': 184.8853730780552, '2022-08': 193.1076630202111, '2022-09': 187.59094875229226, '2022-10': 172.69201604926835, '2022-11': 196.6993613419533, '2022-12': 200.4980547529171}

print()
print("curs_below_median_avg_all: ", curs_below_median_avg_all)
print("curs_above_median_avg_all: ", curs_above_median_avg_all)


div_below_median_avg_all = calculate_difference(cum_below_median_avg_all, curs_below_median_avg_all)
div_above_median_avg_all = calculate_difference(cum_above_median_avg_all, curs_above_median_avg_all)





plot_returns(curs_below_median_avg_all, div_below_median_avg_all, "акций, коэффициент E/P которых ниже медианы")
plot_returns(curs_above_median_avg_all, div_above_median_avg_all, "акций, коэффициент E/P которых выше медианы")

def calculate_geometric_returns(numbers):
    periods = {
        '120 months (10 years)': 120,
        '10 years': 10,
        '2 years': 5,
        '5 years': 2,
        '10 years (no root needed)': 1
    }

    for num in numbers:
        modified_value = num / 100 + 1
        print(f"Обработка числа: {num}")
        for period, root in periods.items():
            if root == 1:
                return_value = (modified_value - 1) * 100
            else:
                return_value = (modified_value ** (1 / root) - 1) * 100
            print(f"Геометрическая доходность за {period}: {return_value:.2f}%")


low = [231, 183]
high = [314, 200]

calculate_geometric_returns(low)
calculate_geometric_returns(high)