import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.dates as mdates


def calculate_difference(total_returns, price_returns):
    difference = {}
    for date in total_returns.keys():
        if date in price_returns:
            diff = total_returns[date] - price_returns[date]
            difference[date] = diff
    return difference


def plot_returns(price_returns, dividend_returns, name):
   
    dates = sorted(list(price_returns.keys()))

   
    price_values = [price_returns[date] for date in dates]
    dividend_values = [dividend_returns[date] for date in dates]

   
    num_items = len(dates)

   
    positions = np.arange(num_items)

   
    fig, ax = plt.subplots(figsize=(10, 3))

   
    ax.bar(positions, price_values, label='Курсовая доходность', color='b', alpha=0.7)

   
    ax.bar(positions, dividend_values, bottom=price_values, label='Дивидендная доходность', color='lightblue', alpha=0.7)

   
    ax.set_xticks(positions)
    ax.set_xticklabels(dates, rotation=45, ha='right')

   
    for i, label in enumerate(ax.get_xticklabels()):
        if i % 6 != 0 and i % 12 != 0:
            label.set_visible(False)

    y_ticks = np.arange(50, 500, 50)
    ax.set_yticks(y_ticks)
    ax.grid(axis='y', linestyle='--', alpha=0.7)

   
    ax.legend()

   
    ax.set_title(f"Доходность портфеля {name}")
    ax.set_xlabel('Дата')
    ax.set_ylabel('Доходность (%)')

   
    plt.tight_layout()
    plt.show()



cum_below_median_avg_bc = {'2012-01': 0.24753763852063404, '2012-02': 8.95423177934136, '2012-03': 14.052991448337139, '2012-04': 8.865094205064516, '2012-05': 5.0021845251210895, '2012-06': -7.493782598925225, '2012-07': -2.4105730765387356, '2012-08': -2.439469696422214, '2012-09': -0.44788933107450246, '2012-10': 1.9431498728749386, '2012-11': 1.0152656806158733, '2012-12': 0.9062979163006135, '2013-01': 8.468723749384077, '2013-02': 10.423311982901872, '2013-03': 5.29019390396539, '2013-04': 1.6635067201625775, '2013-05': -3.34088253462711, '2013-06': -5.107724382144352, '2013-07': -4.7721210344420895, '2013-08': 1.9695028966813188, '2013-09': 2.160283676185104, '2013-10': 9.210750444966486, '2013-11': 12.990394017878293, '2013-12': 10.553732568369467, '2014-01': 13.097868532758161, '2014-02': 12.329266916374682, '2014-03': 7.6282926217043245, '2014-04': 6.159849781951787, '2014-05': 1.1409859386920074, '2014-06': 12.46069338868956, '2014-07': 16.436427789821018, '2014-08': 8.374919124978097, '2014-09': 10.783199291666312, '2014-10': 13.779611420321869, '2014-11': 19.6411767611798, '2014-12': 24.973505270223818, '2015-01': 21.45935853744405, '2015-02': 45.65220169634665, '2015-03': 54.571778498849795, '2015-04': 40.70549013128073, '2015-05': 49.643421545394204, '2015-06': 47.209638742306616, '2015-07': 49.31889998837244, '2015-08': 50.51319943303332, '2015-09': 57.33964060561405, '2015-10': 51.64273069859557, '2015-11': 58.65251346526723, '2015-12': 63.68022766142447, '2016-01': 62.55205922932987, '2016-02': 65.91841463804025, '2016-03': 74.57542192242697, '2016-04': 78.75871779841019, '2016-05': 92.88039446586136, '2016-06': 88.45094610108764, '2016-07': 90.05674372785863, '2016-08': 97.07351119091408, '2016-09': 101.19231120666927, '2016-10': 103.71030752658545, '2016-11': 107.71295306921651, '2016-12': 120.67920109512778, '2017-01': 136.1172517147358, '2017-02': 137.97835005117588, '2017-03': 117.08055002923139, '2017-04': 113.70556519314943, '2017-05': 117.04041510697616, '2017-06': 105.39286931583977, '2017-07': 107.53088971504958, '2017-08': 111.71255192480575, '2017-09': 123.37491071279074, '2017-10': 130.26586946923285, '2017-11': 133.26904274683352, '2017-12': 137.28744127018234, '2018-01': 139.74273367421168, '2018-02': 165.75445043373782, '2018-03': 166.33992369050185, '2018-04': 164.31815439094555, '2018-05': 173.80423213960535, '2018-06': 173.6366225478268, '2018-07': 174.59980201615392, '2018-08': 182.59503755128938, '2018-09': 188.5198424317593, '2018-10': 211.5689198351616, '2018-11': 192.56846383891468, '2018-12': 202.52946977473405, '2019-01': 195.72730530659464, '2019-02': 211.63797679132364, '2019-03': 209.00265087163922, '2019-04': 211.61986755658523, '2019-05': 222.635666919818, '2019-06': 240.38280319907005, '2019-07': 255.33658633159092, '2019-08': 251.82889474454768, '2019-09': 252.880749221697, '2019-10': 253.97124433315997, '2019-11': 273.45384685215174, '2019-12': 275.8678937517264, '2020-01': 292.1487440761613, '2020-02': 291.93019264089446, '2020-03': 265.88706146207255, '2020-04': 217.1560193824884, '2020-05': 240.58150373956107, '2020-06': 262.2344868473788, '2020-07': 256.65835035699985, '2020-08': 280.9293452034542, '2020-09': 289.7708387514422, '2020-10': 281.76941446525666, '2020-11': 253.92006609527996, '2020-12': 319.1597361021656, '2021-01': 348.1381611748604, '2021-02': 350.9071405072127, '2021-03': 366.3816692398929, '2021-04': 401.61335944405255, '2021-05': 404.9452399066755, '2021-06': 430.109558199233, '2021-07': 442.1081388362318, '2021-08': 443.60328240887475, '2021-09': 460.4338543534436, '2021-10': 493.1805143583456, '2021-11': 505.6324751537292, '2021-12': 467.4651454251604, '2022-01': 471.9336624690473, '2022-02': 446.23041675590105, '2022-03': 299.15081768769875, '2022-04': 354.6561178892069, '2022-05': 318.9910835191669, '2022-06': 308.06247851690347, '2022-07': 288.79876533855315, '2022-08': 281.4619881305764, '2022-09': 318.77533635922777, '2022-10': 241.5670539071058, '2022-11': 278.9361753786098, '2022-12': 283.52488344978417}
cum_above_median_avg_bc = {'2013-01': 8.779873902151847, '2013-02': 18.108315832394005, '2013-03': 14.390703742892065, '2013-04': 6.6803051915280465, '2013-05': 2.0595887749722097, '2013-06': 2.0489141689556067, '2013-07': -1.0049780225431904, '2013-08': 9.337559350395818, '2013-09': 13.453930479121645, '2013-10': 8.308939186215447, '2013-11': 7.686091813806839, '2013-12': 3.5840040440135112, '2014-01': 8.263582927331182, '2014-02': 4.2111208255424915, '2014-03': 5.239725983379073, '2014-04': 1.0692251032934141, '2014-05': -5.3478041195630155, '2014-06': 3.1218879448448478, '2014-07': 4.978251424634772, '2014-08': -1.5081307193430815, '2014-09': 1.2493432893337264, '2014-10': -3.121954538712568, '2014-11': 1.4790315891042072, '2014-12': 13.038583891419474, '2015-01': 9.307002154743959, '2015-02': 22.25087472869052, '2015-03': 46.34440498292922, '2015-04': 40.66489090820162, '2015-05': 53.604176621318885, '2015-06': 54.31283502865152, '2015-07': 51.73900855689473, '2015-08': 56.11745368477976, '2015-09': 61.82852073962637, '2015-10': 58.25807977717472, '2015-11': 84.63669658632931, '2015-12': 88.73559761259922, '2016-01': 89.08403967768746, '2016-02': 87.93849822867213, '2016-03': 101.01298504469386, '2016-04': 118.24090866347122, '2016-05': 125.7912430496963, '2016-06': 140.60468728611482, '2016-07': 148.446073003601, '2016-08': 167.66714832820867, '2016-09': 177.97633783826168, '2016-10': 173.94260326096256, '2016-11': 179.0968171758449, '2016-12': 197.4667854029895, '2017-01': 207.5772387027767, '2017-02': 227.02032910545157, '2017-03': 208.69977249422385, '2017-04': 201.82227653329932, '2017-05': 204.19591645473423, '2017-06': 184.0321689646982, '2017-07': 181.68113969371, '2017-08': 184.47019018433144, '2017-09': 191.30200578824565, '2017-10': 193.86428405428987, '2017-11': 192.51347749198553, '2017-12': 191.2664905250283, '2018-01': 193.49242773835073, '2018-02': 192.87710987484172, '2018-03': 191.89418755217332, '2018-04': 193.08888177531256, '2018-05': 189.82258054686986, '2018-06': 187.47548389631632, '2018-07': 185.8252242101799, '2018-08': 180.6839482921961, '2018-09': 182.90507089287732, '2018-10': 181.26370308202436, '2018-11': 175.2604008872999, '2018-12': 181.58034526946062, '2019-01': 176.10821847138504, '2019-02': 189.6316534678905, '2019-03': 188.3579138373081, '2019-04': 187.1931984101972, '2019-05': 192.29244645712927, '2019-06': 194.47896074235973, '2019-07': 208.94350500704326, '2019-08': 211.32296644250786, '2019-09': 214.4760961346945, '2019-10': 211.20241846778165, '2019-11': 207.96092798934515, '2019-12': 223.09123164561612, '2020-01': 228.04564251943296, '2020-02': 252.81432478135582, '2020-03': 240.4002749278445, '2020-04': 201.6918339746204, '2020-05': 225.76298811782073, '2020-06': 234.8804490221284, '2020-07': 255.0505921758095, '2020-08': 278.276801830333, '2020-09': 288.97200960317826, '2020-10': 298.0070151776999, '2020-11': 284.0086626322508, '2020-12': 320.2626558772481, '2021-01': 325.93908645695444, '2021-02': 339.5442953543775, '2021-03': 363.81844132456393, '2021-04': 371.0210953874832, '2021-05': 369.149295518575, '2021-06': 374.1712062663001, '2021-07': 369.1793778257531, '2021-08': 363.65860227220315, '2021-09': 396.54771928974446, '2021-10': 407.6924393090923, '2021-11': 417.24288400257956, '2021-12': 391.4638813300619, '2022-01': 373.9945523986165, '2022-02': 337.8841025459363, '2022-03': 198.4056385702869, '2022-04': 271.84745704373165, '2022-05': 231.76264263046556, '2022-06': 215.9371152572501, '2022-07': 218.38765896924377, '2022-08': 221.8891138653455, '2022-09': 249.62350923033924, '2022-10': 174.74658366992503, '2022-11': 220.09880835046025, '2022-12': 226.31022094855763}


curs_below_median_avg_bc = {'2012-01': 0.0, '2012-02': 8.576540123041209, '2012-03': 13.16654418024732, '2012-04': 7.72002914441583, '2012-05': 3.724783540667187, '2012-06': -8.615783505177388, '2012-07': -3.9359314647861243, '2012-08': -4.280361473377747, '2012-09': -2.537811049610772, '2012-10': -0.5166700756329634, '2012-11': -1.5304814426290503, '2012-12': -1.8808495476968057, '2013-01': 5.228330355849375, '2013-02': 6.88218047265805, '2013-03': 1.6670124013401288, '2013-04': -2.078062956650062, '2013-05': -7.1366756009425885, '2013-06': -9.073057908534333, '2013-07': -8.990094116491553, '2013-08': -2.784799237350011, '2013-09': -2.8440669890542725, '2013-10': 3.6145549119084297, '2013-11': 6.9571761820710565, '2013-12': 4.408031997019801, '2014-01': 6.463856805492529, '2014-02': 5.389237834760796, '2014-03': 0.6099639712956906, '2014-04': -1.1374140270053679, '2014-05': -6.184347099202059, '2014-06': 3.958474165508963, '2014-07': 7.261735449933027, '2014-08': -0.5427829143485607, '2014-09': 1.2900841985120426, '2014-10': 3.654233856465794, '2014-11': 8.613812880057981, '2014-12': 13.068537379076828, '2015-01': 9.565022309016967, '2015-02': 31.058461649383908, '2015-03': 38.7649609207301, '2015-04': 25.997140161441457, '2015-05': 33.69102206103387, '2015-06': 31.210887858235647, '2015-07': 32.79307574434447, '2015-08': 33.55368170196762, '2015-09': 39.31166472349199, '2015-10': 33.97808634890005, '2015-11': 39.88674612021348, '2015-12': 44.04006096231432, '2016-01': 42.73222751789427, '2016-02': 45.37268571466817, '2016-03': 52.64367453762435, '2016-04': 55.989019682648845, '2016-05': 68.00592039840912, '2016-06': 63.8492301294884, '2016-07': 64.94861634273063, '2016-08': 70.74081231642317, '2016-09': 74.01751053646935, '2016-10': 75.90754981217387, '2016-11': 79.07227897479552, '2016-12': 89.96103284637613, '2017-01': 102.9931470787949, '2017-02': 104.3379321587726, '2017-03': 86.14004618632495, '2017-04': 82.99622692800396, '2017-05': 85.60336099825537, '2017-06': 75.39332658524769, '2017-07': 76.96408316471248, '2017-08': 80.27841458616165, '2017-09': 89.96056869927375, '2017-10': 95.57139432632509, '2017-11': 97.87259563295075, '2017-12': 101.02875686893537, '2018-01': 102.79768971907824, '2018-02': 124.49150580221225, '2018-03': 124.67800529386297, '2018-04': 122.6448539021642, '2018-05': 130.3026145072139, '2018-06': 129.82573690858453, '2018-07': 130.30329527746858, '2018-08': 136.66758478056428, '2018-09': 141.2814573510599, '2018-10': 160.21126071634956, '2018-11': 144.005281564171, '2018-12': 151.9821536874234, '2019-01': 145.95265523286977, '2019-02': 158.8198789310121, '2019-03': 156.26618533490856, '2019-04': 158.0779387234369, '2019-05': 166.8393899086133, '2019-06': 181.1469725686465, '2019-07': 193.13209033350324, '2019-08': 189.86899487759206, '2019-09': 190.36794040327004, '2019-10': 190.89661628745253, '2019-11': 206.53865301138987, '2019-12': 208.15051190299462, '2020-01': 221.20072150052073, '2020-02': 220.72550306431168, '2020-03': 199.10786687985564, '2020-04': 158.95693622575226, '2020-05': 177.76840813823011, '2020-06': 195.11942974958924, '2020-07': 190.2701831990551, '2020-08': 209.72022526089384, '2020-09': 216.60981238921417, '2020-10': 209.80716844027708, '2020-11': 186.9052972698186, '2020-12': 239.49204964052035, '2021-01': 262.7961240800213, '2021-02': 264.8694774379941, '2021-03': 277.22061389164327, '2021-04': 305.55187857450204, '2021-05': 308.0814915380075, '2021-06': 328.2462655642792, '2021-07': 337.7651698688472, '2021-08': 338.80147143198514, '2021-09': 352.21068532251854, '2021-10': 378.4539728039448, '2021-11': 388.320763606767, '2021-12': 357.3660144585374, '2022-01': 360.65560779553687, '2022-02': 339.64287257855864, '2022-03': 220.92184766204733, '2022-04': 265.22363367135375, '2022-05': 236.21917267871825, '2022-06': 227.08334180055644, '2022-07': 211.30097981304138, '2022-08': 205.06368276874394, '2022-09': 234.52835039789863, '2022-10': 172.49230247755548, '2022-11': 201.96617961557953, '2022-12': 205.2973928351362}
curs_above_median_avg_bc = {'2012-01': 0.0, '2012-02': 5.490119352321354, '2012-03': 14.67271960094212, '2012-04': 9.843444279405599, '2012-05': 4.566481460922001, '2012-06': -11.742286897975562, '2012-07': -6.002683115596563, '2012-08': -5.48166570364701, '2012-09': -4.428498554899541, '2012-10': -1.5257581509523166, '2012-11': -4.756746707637105, '2012-12': -5.266060917346649, '2013-01': 2.95130273202735, '2013-02': 11.691513673561538, '2013-03': 8.084926156547123, '2013-04': 0.6767609935905972, '2013-05': -3.8074411008028775, '2013-06': -3.926857166598152, '2013-07': -6.906678927164311, '2013-08': 2.721287142160489, '2013-09': 6.490744934509607, '2013-10': 1.580439725449967, '2013-11': 0.9125203129959791, '2013-12': -3.01799172862135, '2014-01': 0.8957905368097707, '2014-02': -3.3365559980937265, '2014-03': -2.8183019605872217, '2014-04': -6.841258612038493, '2014-05': -12.93481016513567, '2014-06': -5.328479008720199, '2014-07': -3.808985419774946, '2014-08': -9.933323272020633, '2014-09': -7.593949136775658, '2014-10': -11.77781827052482, '2014-11': -7.783092506316958, '2014-12': 2.5387343726273937, '2015-01': -1.068419899769002, '2015-02': 10.422304625425172, '2015-03': 31.950219801381728, '2015-04': 26.621086583533792, '2015-05': 38.07085606010643, '2015-06': 38.5128959693269, '2015-07': 36.02238788740087, '2015-08': 39.76262672857509, '2015-09': 44.689971108029965, '2015-10': 41.291763327970735, '2015-11': 64.64366065957452, '2015-12': 68.0953123815054, '2016-01': 68.03885968552504, '2016-02': 66.61071850080403, '2016-03': 77.8153340117623, '2016-04': 92.74907419628835, '2016-05': 99.11205647762169, '2016-06': 111.8755026439739, '2016-07': 118.42968381838052, '2016-08': 134.9843581862393, '2016-09': 143.6971347940145, '2016-10': 139.83719771021867, '2016-11': 144.04365263287465, '2016-12': 159.7844186090767, '2017-01': 168.32468822775186, '2017-02': 184.98807087240698, '2017-03': 168.73311716390842, '2017-04': 162.49118414444638, '2017-05': 164.30696282289213, '2017-06': 146.53472851494635, '2017-07': 144.2626983144611, '2017-08': 146.45333152375687, '2017-09': 152.14235904854738, '2017-10': 154.12698234948326, '2017-11': 152.7214837277171, '2017-12': 151.4110578802691, '2018-01': 153.11617201731042, '2018-02': 152.36806924557223, '2018-03': 151.3016305411254, '2018-04': 152.1126475279655, '2018-05': 149.0893685319545, '2018-06': 146.83997123971997, '2018-07': 145.19055523114312, '2018-08': 140.56068965733618, '2018-09': 142.2467430170793, '2018-10': 140.62063949655573, '2018-11': 135.27072903332598, '2018-12': 140.4604568398744, '2019-01': 135.37534400155698, '2019-02': 146.49157973252264, '2019-03': 145.00625870395098, '2019-04': 143.62124586025558, '2019-05': 147.54983789374458, '2019-06': 148.9974598419301, '2019-07': 160.83179729957936, '2019-08': 162.44810242605334, '2019-09': 164.71392664931682, '2019-10': 161.56348402791897, '2019-11': 158.43810238897706, '2019-12': 170.73364252088993, '2020-01': 174.569974681279, '2020-02': 194.97514388046037, '2020-03': 184.26040174219378, '2020-04': 151.56387412998873, '2020-05': 171.25199590220808, '2020-06': 178.46625847070263, '2020-07': 194.83816235830028, '2020-08': 213.68448149941898, '2020-09': 222.11849675651573, '2020-10': 229.20078225362047, '2020-11': 217.21791185473478, '2020-12': 246.76552936876277, '2021-01': 251.29926197693092, '2021-02': 262.3683576910971, '2021-03': 282.23397432948525, '2021-04': 287.987019314435, '2021-05': 286.26256617751966, '2021-06': 290.2130525740701, '2021-07': 285.93790019403144, '2021-08': 281.221663829543, '2021-09': 308.07622982113463, '2021-10': 317.02205271266763, '2021-11': 324.6424501407734, '2021-12': 303.2767216016086, '2022-01': 288.83649583203965, '2022-02': 259.1052003536734, '2022-03': 144.6058175765525, '2022-04': 204.69119013799008, '2022-05': 171.7258769142319, '2022-06': 158.6429210504134, '2022-07': 160.53862805663246, '2022-08': 163.2978308945523, '2022-09': 185.88100514206812, '2022-10': 124.54455122302109, '2022-11': 161.50289951144634, '2022-12': 166.4736483155074}


div_below_median_avg_bc = calculate_difference(cum_below_median_avg_bc, curs_below_median_avg_bc)
div_above_median_avg_bc = calculate_difference(cum_above_median_avg_bc, curs_above_median_avg_bc)


print("div_below_median_avg_bc: ", div_below_median_avg_bc)
print("div_above_median_avg_bc: ", div_above_median_avg_bc)







cum_below_median_avg_all = {'2013-04': -3.2098208662893035, '2013-05': -7.402569630783795, '2013-06': -8.535482152655904, '2013-07': -8.363467521932177, '2013-08': -2.5779977101193063, '2013-09': -1.707533681576845, '2013-10': 4.009602556829095, '2013-11': 7.2343836484786594, '2013-12': 4.7911962837471345, '2014-01': 7.769062926414905, '2014-02': 6.216157637813868, '2014-03': 1.5754411463563933, '2014-04': 0.86479844235956, '2014-05': -2.8148285808567097, '2014-06': 7.683818398035025, '2014-07': 9.44627944563945, '2014-08': 2.216580396544865, '2014-09': 5.02775256864576, '2014-10': 6.5892739402717115, '2014-11': 12.772006141019565, '2014-12': 16.95303899829479, '2015-01': 11.756998363640282, '2015-02': 33.09237346639273, '2015-03': 43.612555082833325, '2015-04': 34.01841313345246, '2015-05': 41.997824149126785, '2015-06': 39.35342422567998, '2015-07': 40.23316246008153, '2015-08': 42.373040445266156, '2015-09': 48.56849878981364, '2015-10': 44.24553486311795, '2015-11': 50.12872078541562, '2015-12': 54.6298571324662, '2016-01': 54.828050836527154, '2016-02': 57.83210711057576, '2016-03': 65.38025681956287, '2016-04': 69.20457142091914, '2016-05': 77.24897892784396, '2016-06': 76.29711776240423, '2016-07': 77.73299398020677, '2016-08': 84.14347208024864, '2016-09': 88.56765074715305, '2016-10': 90.96171914075586, '2016-11': 93.72643556190884, '2016-12': 104.86942642268468, '2017-01': 117.0889158630668, '2017-02': 120.62770098928377, '2017-03': 104.86228727286418, '2017-04': 102.48137672607736, '2017-05': 102.55828495012045, '2017-06': 95.47956012640351, '2017-07': 95.2871909273023, '2017-08': 99.53851548959992, '2017-09': 109.0280226122569, '2017-10': 115.44263719406591, '2017-11': 117.79899847407856, '2017-12': 119.26748877048037, '2018-01': 121.04362728144893, '2018-02': 140.3216355291405, '2018-03': 140.55787468991548, '2018-04': 138.89474674659422, '2018-05': 145.0898033069229, '2018-06': 144.34746414075397, '2018-07': 144.07188049251985, '2018-08': 148.45845231046636, '2018-09': 151.6437738206207, '2018-10': 167.59901563921957, '2018-11': 154.42630835707698, '2018-12': 160.66441467115865, '2019-01': 155.32104474325035, '2019-02': 167.61071268333598, '2019-03': 166.9480398066967, '2019-04': 168.1172491909191, '2019-05': 177.2051981274298, '2019-06': 189.16566730798382, '2019-07': 202.23459999241982, '2019-08': 201.3916503270827, '2019-09': 201.5964827818689, '2019-10': 205.49941136603093, '2019-11': 220.12647957549865, '2019-12': 223.3246248329959, '2020-01': 237.17290013113782, '2020-02': 240.19557075034706, '2020-03': 218.05712846173125, '2020-04': 174.60405185223345, '2020-05': 195.92539550642732, '2020-06': 213.17190279992565, '2020-07': 210.80143770351887, '2020-08': 229.01449930651228, '2020-09': 235.45951096801141, '2020-10': 228.88310236083598, '2020-11': 205.6679462004193, '2020-12': 257.851528326322, '2021-01': 278.1705571112333, '2021-02': 281.27196400082937, '2021-03': 295.7116409975588, '2021-04': 323.4625390244724, '2021-05': 325.19885186755477, '2021-06': 346.7344982722444, '2021-07': 358.51673324515554, '2021-08': 359.34674383827314, '2021-09': 377.3157979038909, '2021-10': 405.44647534018134, '2021-11': 418.9162597422708, '2021-12': 393.6623531049924, '2022-01': 397.74784919642013, '2022-02': 374.5495906850148, '2022-03': 252.19981688686124, '2022-04': 305.3994155072308, '2022-05': 275.78821956682043, '2022-06': 264.73940848589973, '2022-07': 250.7277729182773, '2022-08': 248.2885712292275, '2022-09': 281.8130417353116, '2022-10': 211.24319592119446, '2022-11': 249.9846024959358, '2022-12': 255.3270391027913}
cum_above_median_avg_all = {'2013-04': -6.439888276133388, '2013-05': -13.64789862561764, '2013-06': -15.676183631115503, '2013-07': -16.05476731947042, '2013-08': -14.632045563588058, '2013-09': -15.917969219517614, '2013-10': -20.337649917315858, '2013-11': -23.3870170066391, '2013-12': -29.07088062407286, '2014-01': -22.442796259519525, '2014-02': -19.967350832732368, '2014-03': -24.51704848626082, '2014-04': -21.537810442642602, '2014-05': -24.999904825957408, '2014-06': -15.01053860006023, '2014-07': -13.782791016558715, '2014-08': -13.983847211221656, '2014-09': -13.875212792604795, '2014-10': -13.821281253036489, '2014-11': -13.960492371922339, '2014-12': -11.108481219001654, '2015-01': -7.8157375979591714, '2015-02': -10.129190403400301, '2015-03': 1.8563414479838558, '2015-04': -6.089754342229902, '2015-05': 1.8421141436151478, '2015-06': 1.3403175012605573, '2015-07': 4.596299817849259, '2015-08': 1.8425643516209789, '2015-09': 6.45656487347257, '2015-10': 5.851338826857622, '2015-11': 6.97595558387385, '2015-12': 6.327986911594152, '2016-01': 7.312489823931889, '2016-02': 10.406801793467292, '2016-03': 14.993635547404205, '2016-04': 19.560438792309533, '2016-05': 28.11744366920461, '2016-06': 28.733960444157127, '2016-07': 24.928642472071495, '2016-08': 39.631916931882174, '2016-09': 48.42000911574864, '2016-10': 52.08654683146725, '2016-11': 65.24566486810916, '2016-12': 87.6049621199201, '2017-01': 97.01556897696, '2017-02': 111.6932682491632, '2017-03': 102.06887635424931, '2017-04': 102.18182095181665, '2017-05': 116.92514594177017, '2017-06': 110.87087248656874, '2017-07': 122.87091482284067, '2017-08': 137.6303827443175, '2017-09': 159.47240798292665, '2017-10': 177.20739500968264, '2017-11': 177.36175184391496, '2017-12': 169.47031005398162, '2018-01': 176.7721866719212, '2018-02': 190.2638679121155, '2018-03': 192.40444568396805, '2018-04': 187.75774524643816, '2018-05': 187.72626902422215, '2018-06': 187.65137982910156, '2018-07': 189.04244614849662, '2018-08': 185.99267074870022, '2018-09': 172.16082472257307, '2018-10': 181.6610081547763, '2018-11': 170.6057292722788, '2018-12': 178.9545867443825, '2019-01': 174.0944367409799, '2019-02': 197.28426216061195, '2019-03': 197.31298072265827, '2019-04': 208.62988900477526, '2019-05': 221.02856671702617, '2019-06': 215.50285954125195, '2019-07': 217.28634430484027, '2019-08': 217.43163377463745, '2019-09': 208.7648012499546, '2019-10': 220.4147146087029, '2019-11': 224.041279460744, '2019-12': 235.76512755682498, '2020-01': 255.7936798062419, '2020-02': 280.6811275716885, '2020-03': 269.54859279379986, '2020-04': 229.33857174137268, '2020-05': 249.8615996761084, '2020-06': 265.2780050796886, '2020-07': 274.721291255976, '2020-08': 296.3835006597704, '2020-09': 316.6948230013658, '2020-10': 304.4711071662382, '2020-11': 295.0655691805726, '2020-12': 327.8230199486294, '2021-01': 356.8239379086342, '2021-02': 386.4852153371354, '2021-03': 402.3772067179675, '2021-04': 411.1194361957823, '2021-05': 418.81675347612645, '2021-06': 434.48972170042987, '2021-07': 425.7714799664405, '2021-08': 415.52130500471094, '2021-09': 450.1972985070078, '2021-10': 482.8801279105281, '2021-11': 544.1761470430827, '2021-12': 498.91423862831965, '2022-01': 471.13798983248773, '2022-02': 453.7232280384849, '2022-03': 337.30556830544265, '2022-04': 403.00489440115933, '2022-05': 398.28492249113305, '2022-06': 403.4047323885277, '2022-07': 375.5405688883722, '2022-08': 380.65119764401413, '2022-09': 406.94171834245384, '2022-10': 324.302492651649, '2022-11': 383.12170710136246, '2022-12': 399.0268128468653}
cum_top_ten_avg_all = {'2013-01': 7.378986549309641, '2013-02': 9.51875179438555, '2013-03': 4.386139847253245, '2013-04': 1.121714676599761, '2013-05': -4.252129789195946, '2013-06': -5.49559686147183, '2013-07': -5.139922926380514, '2013-08': 1.014274566624218, '2013-09': 1.2771544228064924, '2013-10': 8.435660093757335, '2013-11': 11.808964880770588, '2013-12': 8.601544088932966, '2014-01': 8.502016115700627, '2014-02': 9.518941122732304, '2014-03': 4.540672157106651, '2014-04': 4.089673997492005, '2014-05': -1.0920116871603103, '2014-06': 9.739105846929942, '2014-07': 14.350359625905407, '2014-08': 4.410314619001032, '2014-09': 6.232385914899297, '2014-10': 9.421914465668713, '2014-11': 14.372534191667263, '2014-12': 17.988797050727623, '2015-01': 15.376498026350639, '2015-02': 37.681573511718504, '2015-03': 47.89333207842865, '2015-04': 33.94556391604533, '2015-05': 43.579989943095065, '2015-06': 41.42373135253954, '2015-07': 43.440544110156296, '2015-08': 44.350481942473884, '2015-09': 50.0959498855398, '2015-10': 43.09490913721883, '2015-11': 49.611801471810615, '2015-12': 56.04539121047951, '2016-01': 53.83559832084855, '2016-02': 57.199189599841226, '2016-03': 64.80524009622839, '2016-04': 68.0206200598455, '2016-05': 81.8015299103722, '2016-06': 76.205048610131, '2016-07': 77.31905146561473, '2016-08': 81.88086137196291, '2016-09': 85.7572569979115, '2016-10': 88.2279956947149, '2016-11': 90.43978058842353, '2016-12': 101.60328614870093, '2017-01': 117.62144665234126, '2017-02': 113.239632263548, '2017-03': 92.94199435965294, '2017-04': 89.92768522066723, '2017-05': 92.16804489654902, '2017-06': 80.6474548071989, '2017-07': 82.09999294729928, '2017-08': 84.83350589534446, '2017-09': 92.51175284186664, '2017-10': 99.84073800886631, '2017-11': 103.22938514776787, '2017-12': 108.55583477378575, '2018-01': 112.09167544339213, '2018-02': 137.83270865031264, '2018-03': 137.6713139638676, '2018-04': 135.32549525655085, '2018-05': 147.09001799938258, '2018-06': 148.11942762166385, '2018-07': 148.33051793541466, '2018-08': 157.1251197732954, '2018-09': 164.22968984474952, '2018-10': 188.06333980100166, '2018-11': 169.09815809947358, '2018-12': 177.45212908636847, '2019-01': 170.1737014763173, '2019-02': 185.38506737502667, '2019-03': 182.40246655490648, '2019-04': 186.0367611830548, '2019-05': 198.06889257005605, '2019-06': 218.12212371134413, '2019-07': 229.58457446810434, '2019-08': 225.31956438445278, '2019-09': 224.13738478968858, '2019-10': 226.28792302796228, '2019-11': 246.895606566156, '2019-12': 247.13753220161482, '2020-01': 260.17710655373907, '2020-02': 257.6216342506485, '2020-03': 232.63722268216003, '2020-04': 183.13081182308974, '2020-05': 204.1330341333813, '2020-06': 225.6936663836027, '2020-07': 221.17158380886886, '2020-08': 239.23572014227483, '2020-09': 247.638549922293, '2020-10': 235.52221440708246, '2020-11': 205.43160145502716, '2020-12': 269.6223985016876, '2021-01': 294.0632222609725, '2021-02': 297.20745001903526, '2021-03': 311.93510588936607, '2021-04': 340.6852451054803, '2021-05': 335.7015430060133, '2021-06': 359.34260854365806, '2021-07': 375.73727582058274, '2021-08': 373.49646012383363, '2021-09': 387.11302028057366, '2021-10': 422.98270101510553, '2021-11': 434.9295729771907, '2021-12': 399.01338937213467, '2022-01': 400.21119566977796, '2022-02': 380.0341964617451, '2022-03': 247.62141114002958, '2022-04': 292.14311992795695, '2022-05': 261.37720508431397, '2022-06': 252.63002780747718, '2022-07': 228.63375609647468, '2022-08': 223.69657938075002, '2022-09': 259.1686997535553, '2022-10': 194.92845318502478, '2022-11': 226.8779249005549, '2022-12': 231.03019830102153}


curs_below_median_avg_all = {'2013-04': -3.4705778310535673, '2013-05': -7.909575044276318, '2013-06': -9.2904052016065, '2013-07': -9.375531208570864, '2013-08': -3.908474807093576, '2013-09': -3.3059461262433087, '2013-10': 2.0573812234075284, '2013-11': 4.9632971987982, '2013-12': 2.3160513560048113, '2014-01': 4.892447453761717, '2014-02': 3.0468851650100603, '2014-03': -1.802571925843821, '2014-04': -2.8402329677734706, '2014-05': -6.7362173725508345, '2014-06': 2.998241288658332, '2014-07': 4.337130077151774, '2014-08': -2.905502187213338, '2014-09': -0.5830481277135591, '2014-10': 0.5472751755555283, '2014-11': 6.027119541646364, '2014-12': 9.599435014284863, '2015-01': 4.3978911809662735, '2015-02': 23.99107410174932, '2015-03': 33.46099405093901, '2015-04': 24.239182317761877, '2015-05': 31.340094760857905, '2015-06': 28.59719120375399, '2015-07': 29.11680268383097, '2015-08': 30.79067674995539, '2015-09': 36.18643344995422, '2015-10': 31.934721143172595, '2015-11': 37.03051306564347, '2015-12': 40.856532583315456, '2016-01': 40.7453613804642, '2016-02': 43.18208929641387, '2016-03': 49.73489224144314, '2016-04': 52.89867745483852, '2016-05': 59.8700931934129, '2016-06': 58.71847632077605, '2016-07': 59.72011173910987, '2016-08': 65.19040785209815, '2016-09': 68.87479626288385, '2016-10': 70.73378485242421, '2016-11': 72.9192408289563, '2016-12': 82.57874727055056, '2017-01': 93.23045355104007, '2017-02': 96.14508667140709, '2017-03': 81.89601628374265, '2017-04': 79.5482930469777, '2017-05': 79.38137835332827, '2017-06': 72.87663844654774, '2017-07': 72.46812391802557, '2017-08': 75.98691495612688, '2017-09': 84.12209763561349, '2017-10': 89.53601726538125, '2017-11': 91.371546461304, '2017-12': 92.42240626615536, '2018-01': 93.68881426091156, '2018-02': 110.28916784225294, '2018-03': 110.20311927830173, '2018-04': 108.4455688775543, '2018-05': 113.54185844998428, '2018-06': 112.58307960463173, '2018-07': 112.02945924110112, '2018-08': 115.51763707153854, '2018-09': 117.95068701637206, '2018-10': 131.43975841851812, '2018-11': 119.72301916959496, '2018-12': 124.79012443061337, '2019-01': 119.7937373519577, '2019-02': 129.9889489220293, '2019-03': 129.0316420770273, '2019-04': 129.6539332154109, '2019-05': 137.05293875547935, '2019-06': 146.88372284657697, '2019-07': 157.6476347326966, '2019-08': 156.53064922237948, '2019-09': 156.30908640000425, '2019-10': 159.2320739401692, '2019-11': 171.2526479103699, '2019-12': 173.57128330353433, '2020-01': 184.99806113659685, '2020-02': 187.26316063655895, '2020-03': 168.27033270218865, '2020-04': 131.30888945966365, '2020-05': 148.95673679632773, '2020-06': 163.15880611413243, '2020-07': 160.8583853897097, '2020-08': 175.83597060535564, '2020-09': 180.93384533856627, '2020-10': 175.12095428243364, '2020-11': 155.3959839343503, '2020-12': 198.69428517219174, '2021-01': 215.47986651414317, '2021-02': 217.8912468132109, '2021-03': 229.75278960746243, '2021-04': 252.70511762959953, '2021-05': 253.97862901001798, '2021-06': 271.7281572176468, '2021-07': 281.35044712369876, '2021-08': 281.8602047194754, '2021-09': 296.61182303759944, '2021-10': 319.79513424925176, '2021-11': 330.7945524105247, '2021-12': 309.6387422772535, '2022-01': 312.75570937049474, '2022-02': 293.2490072834913, '2022-03': 191.56435376165396, '2022-04': 235.32427955975152, '2022-05': 210.52666201626272, '2022-06': 201.0830381930798, '2022-07': 189.2269906509994, '2022-08': 186.9102042228677, '2022-09': 214.21094038399784, '2022-10': 155.83395653282906, '2022-11': 187.39594968773457, '2022-12': 191.5115188601094}
curs_above_median_avg_all = {'2013-04': -6.575084911291662, '2013-05': -13.926251462419536, '2013-06': -16.093441694113253, '2013-07': -16.568297206025527, '2013-08': -15.26966205600625, '2013-09': -16.65868231023978, '2013-10': -21.157291172786064, '2013-11': -24.29147551782016, '2013-12': -30.02712233487187, '2014-01': -23.721013922287494, '2014-02': -21.50436007827201, '2014-03': -26.176701913921264, '2014-04': -23.471163706581343, '2014-05': -27.080576936666635, '2014-06': -17.6053517265215, '2014-07': -16.61343528295821, '2014-08': -17.014137127062533, '2014-09': -17.121117525505102, '2014-10': -17.25613252646744, '2014-11': -17.579660397259957, '2014-12': -15.019074787895404, '2015-01': -12.02258882970596, '2015-02': -14.383188188280515, '2015-03': -3.114390704629766, '2015-04': -10.814122939365555, '2015-05': -3.4148148550308677, '2015-06': -4.025855087071539, '2015-07': -1.0597100492946598, '2015-08': -3.7851362300368896, '2015-09': 0.45625749482851585, '2015-10': -0.2212909333370705, '2015-11': 0.7304041618946044, '2015-12': -0.007394883416167453, '2016-01': 0.037612292261046676, '2016-02': 1.5721961624016956, '2016-03': 4.509272067186765, '2016-04': 7.438040385407185, '2016-05': 13.825396460280782, '2016-06': 13.081427259819357, '2016-07': 8.395901148873651, '2016-08': 19.955755101389826, '2016-09': 26.389282951852945, '2016-10': 28.451661462692336, '2016-11': 38.52134472690525, '2016-12': 56.1421272810511, '2017-01': 63.31895457796026, '2017-02': 74.77100442262439, '2017-03': 66.16202868527874, '2017-04': 65.6996102337168, '2017-05': 77.26557233644672, '2017-06': 71.76551474940884, '2017-07': 80.99376670851046, '2017-08': 92.47671797568108, '2017-09': 109.69224434430416, '2017-10': 123.5640776269639, '2017-11': 123.20626974860032, '2017-12': 116.36968324430383, '2018-01': 121.45705715062998, '2018-02': 131.5017290094151, '2018-03': 132.45957886694185, '2018-04': 127.95811362467266, '2018-05': 127.12714232840648, '2018-06': 126.21697018939626, '2018-07': 126.50089914495597, '2018-08': 123.34114303698782, '2018-09': 111.75182812311606, '2018-10': 118.35839729887132, '2018-11': 109.03016436331576, '2018-12': 114.68815065175062, '2019-01': 110.03732054505697, '2019-02': 126.88437936272462, '2019-03': 126.06423178373602, '2019-04': 133.84243859346543, '2019-05': 142.39868648563223, '2019-06': 137.3598293604283, '2019-07': 137.77610379478068, '2019-08': 136.94694389329024, '2019-09': 129.58175821126505, '2019-10': 137.41559297723117, '2019-11': 139.2443338421236, '2019-12': 147.0107319709704, '2020-01': 161.00005487178302, '2020-02': 178.46057212376536, '2020-03': 169.52074642467028, '2020-04': 139.83340968019093, '2020-05': 154.39567728790382, '2020-06': 165.209040396859, '2020-07': 171.68310344712495, '2020-08': 187.04316954972376, '2020-09': 201.41578059334287, '2020-10': 192.2577118897981, '2020-11': 185.15899214892374, '2020-12': 208.48939035910843, '2021-01': 228.93037558906033, '2021-02': 249.81909231879143, '2021-03': 260.77254479720335, '2021-04': 266.64886709291056, '2021-05': 271.7780314060607, '2021-06': 282.6070301065558, '2021-07': 275.9539765726837, '2021-08': 268.2157313631666, '2021-09': 292.58107886542774, '2021-10': 315.4666578569875, '2021-11': 358.7277754003297, '2021-12': 326.04687876198045, '2022-01': 306.13507694968024, '2022-02': 293.6035813962652, '2022-03': 210.71664481817072, '2022-04': 257.25160722321766, '2022-05': 253.74273081693764, '2022-06': 257.2301092814475, '2022-07': 237.30081018652308, '2022-08': 240.77582212528105, '2022-09': 259.2604213828964, '2022-10': 200.54063166555963, '2022-11': 242.04405498156643, '2022-12': 253.1421950127302}
curs_top_ten_avg_all = {'2013-01': 7.113478770468062, '2013-02': 8.985429418265166, '2013-03': 3.6115210242829487, '2013-04': 0.10312112370787219, '2013-05': -5.479133045147777, '2013-06': -6.969380986820662, '2013-07': -6.882566297367553, '2013-08': -1.1047177677359854, '2013-09': -1.1138317716516521, '2013-10': 5.606652061405093, '2013-11': 8.626334780669698, '2013-12': 5.24429143759606, '2014-01': 4.778822590852383, '2014-02': 5.38726048178868, '2014-03': 0.20644415239750025, '2014-04': -0.6157026119278597, '2014-05': -5.95111047157324, '2014-06': 3.9652792197386377, '2014-07': 7.943604206939181, '2014-08': -1.8332717350307726, '2014-09': -0.5124727174677823, '2014-10': 2.0839532902838798, '2014-11': 6.30836575983067, '2014-12': 9.268499121048812, '2015-01': 6.523884943865355, '2015-02': 26.78753086295922, '2015-03': 35.864495855982994, '2015-04': 22.728707297669224, '2015-05': 31.246216990717237, '2015-06': 28.969564350879363, '2015-07': 30.503978024274424, '2015-08': 31.020635552568443, '2015-09': 35.92560077734275, '2015-10': 29.285589425908576, '2015-11': 34.879290162011564, '2015-12': 40.38992555839451, '2016-01': 38.0879708661249, '2016-02': 40.79303621934649, '2016-03': 47.2923154210241, '2016-04': 49.850477975274686, '2016-05': 61.83257021478632, '2016-06': 56.54985478359582, '2016-07': 57.23464386660228, '2016-08': 60.97408694637308, '2016-09': 64.10337891933457, '2016-10': 65.98172052334009, '2016-11': 67.62499696657021, '2016-12': 77.14709410803171, '2017-01': 90.96904613088743, '2017-02': 86.87355438083333, '2017-03': 68.83850930893831, '2017-04': 65.95465822648323, '2017-05': 67.66639311951369, '2017-06': 57.36809473900213, '2017-07': 58.38454214030187, '2017-08': 60.519029566695636, '2017-09': 66.94714594129081, '2017-10': 73.06333576831632, '2017-11': 75.75697431902965, '2017-12': 80.11954421386334, '2018-01': 82.86072401920852, '2018-02': 104.7465667734631, '2018-03': 104.30263514650422, '2018-04': 101.96398480255641, '2018-05': 111.7314059289602, '2018-06': 112.28092645800412, '2018-07': 112.13059262208813, '2018-08': 119.30071748414477, '2018-09': 125.01087951198207, '2018-10': 144.9574751480302, '2018-11': 128.48876458648047, '2018-12': 135.2451063492333, '2019-01': 128.6968019672253, '2019-02': 141.19304110571437, '2019-03': 138.29312499805812, '2019-04': 140.9891367969348, '2019-05': 150.75274087491076, '2019-06': 167.23790237973714, '2019-07': 176.48509141262795, '2019-08': 172.52027049082784, '2019-09': 171.14509627632364, '2019-10': 172.5587886680958, '2019-11': 189.3873975545504, '2019-12': 189.20249235437177, '2020-01': 199.79417954669546, '2020-02': 197.39179042455567, '2020-03': 176.33347247302206, '2020-04': 134.9225085935572, '2020-05': 152.06145030574473, '2020-06': 169.6517537045975, '2020-07': 165.63222424812886, '2020-08': 180.30178129540167, '2020-09': 186.979982948863, '2020-10': 176.71552582990336, '2020-11': 151.63811161295814, '2020-12': 204.26410539419902, '2021-01': 224.20868750443591, '2021-02': 226.6203534545733, '2021-03': 238.55161419682935, '2021-04': 262.0053135016509, '2021-05': 257.73771768408517, '2021-06': 276.9667062869107, '2021-07': 290.2349032920224, '2021-08': 288.2127210843505, '2021-09': 299.1856529603656, '2021-10': 328.3860756587387, '2021-11': 337.9824083041914, '2021-12': 308.38146339045284, '2022-01': 309.0300343955545, '2022-02': 292.2044244588408, '2022-03': 183.6716482909268, '2022-04': 219.67407756506324, '2022-05': 194.234398616466, '2022-06': 186.7447960142421, '2022-07': 166.89892582046508, '2022-08': 162.5313041078656, '2022-09': 190.9250850193972, '2022-10': 138.53096439174436, '2022-11': 164.03985214387438, '2022-12': 167.0761913743244}


div_below_median_avg_all = calculate_difference(cum_below_median_avg_all, curs_below_median_avg_all)
div_above_median_avg_all = calculate_difference(cum_above_median_avg_all, curs_above_median_avg_all)
div_top_ten_avg_all = calculate_difference(cum_top_ten_avg_all, curs_top_ten_avg_all)


print("div_below_median_avg_all: ", div_below_median_avg_all)
print("div_above_median_avg_all: ", div_above_median_avg_all)
print("div_top_ten_avg_all: ", div_top_ten_avg_all)


plot_returns(curs_below_median_avg_all, div_below_median_avg_all, "акций, капитализация которых выше медианы")
plot_returns(curs_above_median_avg_all, div_above_median_avg_all, "акций, капитализация которых ниже медианы")
plot_returns(curs_top_ten_avg_all, div_top_ten_avg_all, "10 крупнейших акций")




def calculate_geometric_returns(numbers):
    periods = {
        '120 months (10 years)': 120,
        '10 years': 10,
        '2 years': 5,
        '5 years': 2,
        '10 years (no root needed)': 1
    }

    for num in numbers:
        modified_value = num / 100 + 1
        print(f"Обработка числа: {num}")
        for period, root in periods.items():
            if root == 1:
                return_value = (modified_value - 1) * 100
            else:
                return_value = (modified_value ** (1 / root) - 1) * 100
            print(f"Геометрическая доходность за {period}: {return_value:.2f}%")


high = [399, 253]
low = [255, 191]
top = [231, 167]

calculate_geometric_returns(high)
calculate_geometric_returns(low)
calculate_geometric_returns(top)