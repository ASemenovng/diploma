import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.dates as mdates


def calculate_difference(total_returns, price_returns):
    difference = {}
    for date in total_returns.keys():
        if date in price_returns:
            diff = total_returns[date] - price_returns[date]
            difference[date] = diff
    return difference


def plot_returns(price_returns, dividend_returns, name):
   
    dates = sorted(list(price_returns.keys()))

   
    price_values = [price_returns[date] for date in dates]
    dividend_values = [dividend_returns[date] for date in dates]

   
    num_items = len(dates)

   
    positions = np.arange(num_items)

   
    fig, ax = plt.subplots(figsize=(10, 3))

   
    ax.bar(positions, price_values, label='Курсовая доходность', color='b', alpha=0.7)

   
    ax.bar(positions, dividend_values, bottom=price_values, label='Дивидендная доходность', color='lightblue', alpha=0.7)

   
    ax.set_xticks(positions)
    ax.set_xticklabels(dates, rotation=45, ha='right')

   
    for i, label in enumerate(ax.get_xticklabels()):
        if i % 6 != 0 and i % 12 != 0:
            label.set_visible(False)

    y_ticks = np.arange(50, 500, 50)
    ax.set_yticks(y_ticks)
    ax.grid(axis='y', linestyle='--', alpha=0.7)

   
    ax.legend()

   
    ax.set_title(f"Доходность портфеля {name}")
    ax.set_xlabel('Дата')
    ax.set_ylabel('Доходность (%)')

   
    plt.tight_layout()
    plt.show()



cum_below_median_avg_bc = {'2013-01': 5.316450779121329, '2013-02': 9.916108677497636, '2013-03': 3.702143669270086, '2013-04': -4.454849495267455, '2013-05': -10.384305801196437, '2013-06': -11.38348296783711, '2013-07': -10.188911008586764, '2013-08': -4.689319089028388, '2013-09': -4.074328093100865, '2013-10': -3.1250729916221798, '2013-11': -3.5144535090851026, '2013-12': -9.125348392170618, '2014-01': -2.206743252801424, '2014-02': -4.3708606266003365, '2014-03': -12.409389950929828, '2014-04': -15.406689912316128, '2014-05': -19.496010442971155, '2014-06': -8.32563842265639, '2014-07': -8.0358065294986, '2014-08': -13.843538983078052, '2014-09': -11.849632736783066, '2014-10': -16.723244934315893, '2014-11': -14.416698070327671, '2014-12': -9.662981605695931, '2015-01': -9.003075408882498, '2015-02': 1.7855660977007082, '2015-03': 16.813568544936697, '2015-04': 10.115134376374545, '2015-05': 14.776271249388962, '2015-06': 16.381979604591447, '2015-07': 15.341232720144093, '2015-08': 17.20525061516438, '2015-09': 21.16060250897924, '2015-10': 17.76550259852534, '2015-11': 26.483645969481206, '2015-12': 28.381109198703225, '2016-01': 31.12152933241683, '2016-02': 32.49432240142107, '2016-03': 44.2226940621653, '2016-04': 55.00030313214408, '2016-05': 65.57690501568494, '2016-06': 72.25375183834166, '2016-07': 74.73496358481606, '2016-08': 87.21206380550865, '2016-09': 95.88515976900509, '2016-10': 104.11289227967475, '2016-11': 117.31845100916081, '2016-12': 137.00517964062, '2017-01': 154.24427952633374, '2017-02': 172.3315012752935, '2017-03': 151.13671900660503, '2017-04': 148.7509521750569, '2017-05': 164.19263702719377, '2017-06': 149.65812330908412, '2017-07': 153.77276293923558, '2017-08': 158.82859653066933, '2017-09': 174.84698831041908, '2017-10': 177.23547754166856, '2017-11': 174.36767840925515, '2017-12': 167.61795806373442, '2018-01': 175.60302862881807, '2018-02': 184.62983482812754, '2018-03': 185.83156467653174, '2018-04': 180.41517123892586, '2018-05': 174.99125730228457, '2018-06': 174.0848680666779, '2018-07': 174.13198644242414, '2018-08': 170.3432344488384, '2018-09': 165.97927987456066, '2018-10': 175.88268580759805, '2018-11': 160.78559005220376, '2018-12': 166.10531501493261, '2019-01': 159.033069208783, '2019-02': 175.59790546901382, '2019-03': 177.55060649685294, '2019-04': 177.05019104115968, '2019-05': 184.2729499802516, '2019-06': 188.95463654331394, '2019-07': 206.91015801678992, '2019-08': 210.1813721175609, '2019-09': 214.28343137604165, '2019-10': 218.52567081980192, '2019-11': 225.14614964132048, '2019-12': 232.56783818714712, '2020-01': 245.74115203136338, '2020-02': 270.4619684225405, '2020-03': 258.7590368628656, '2020-04': 218.3540252990951, '2020-05': 245.04249498038138, '2020-06': 255.85251788310438, '2020-07': 267.06877000661746, '2020-08': 302.5822864359344, '2020-09': 317.04695276010614, '2020-10': 311.4537907209372, '2020-11': 291.4332616586158, '2020-12': 338.3801361681972, '2021-01': 348.90461613691076, '2021-02': 345.6396428941326, '2021-03': 356.2548527119492, '2021-04': 370.6943397314917, '2021-05': 379.80005473367487, '2021-06': 396.96160451200166, '2021-07': 391.80943068143614, '2021-08': 393.3366069393946, '2021-09': 422.2098716636572, '2021-10': 441.7656940509535, '2021-11': 458.3876779853281, '2021-12': 432.6851759794708, '2022-01': 426.10836894205073, '2022-02': 387.5801038553046, '2022-03': 245.20353835127028, '2022-04': 301.5400159084453, '2022-05': 269.7755547751287, '2022-06': 252.8482368791677, '2022-07': 244.06290432898544, '2022-08': 241.79953335952126, '2022-09': 264.4032519769764, '2022-10': 188.985749863424, '2022-11': 231.59266007281806, '2022-12': 235.64420874533945}
cum_above_median_avg_bc = {'2013-01': 4.022637487186742, '2013-02': 5.997067129044331, '2013-03': 3.9816997660920173, '2013-04': 0.9557684989784487, '2013-05': -0.5885756669922637, '2013-06': -2.8437195117662517, '2013-07': -4.425849041064744, '2013-08': -0.6547321344049672, '2013-09': -1.059267138537645, '2013-10': 0.33978138209702635, '2013-11': 2.1376007032398725, '2013-12': 1.9877346062238788, '2014-01': 3.733378542005039, '2014-02': 1.5415270397287184, '2014-03': 2.2522351808554886, '2014-04': 2.011976441132468, '2014-05': -0.18790394082602857, '2014-06': 6.169393344864038, '2014-07': 8.264445982631695, '2014-08': 5.878119708067153, '2014-09': 8.169321304369737, '2014-10': 10.684528154369865, '2014-11': 15.996297831697316, '2014-12': 19.532495349190484, '2015-01': 12.027371686350353, '2015-02': 24.329533928888768, '2015-03': 28.619595568744693, '2015-04': 25.33724895355789, '2015-05': 30.999976700103748, '2015-06': 28.583740174371776, '2015-07': 29.944161957020476, '2015-08': 31.226648114973464, '2015-09': 34.60450158294919, '2015-10': 33.08367256588913, '2015-11': 35.52845457986638, '2015-12': 36.40643936643728, '2016-01': 36.059374652402695, '2016-02': 37.35004433452151, '2016-03': 40.319724733471716, '2016-04': 42.781438562372685, '2016-05': 45.19259058626841, '2016-06': 46.32478438745908, '2016-07': 47.90044436989971, '2016-08': 53.457980085709146, '2016-09': 53.43222582360065, '2016-10': 51.43185077862267, '2016-11': 52.76584201350416, '2016-12': 58.48308752710783, '2017-01': 61.50566718488615, '2017-02': 63.0771853852625, '2017-03': 57.59038962799703, '2017-04': 56.18674383989095, '2017-05': 55.00376872514858, '2017-06': 52.55636951634286, '2017-07': 53.26087316921975, '2017-08': 54.230362260723375, '2017-09': 57.45725979612435, '2017-10': 59.100059435352215, '2017-11': 60.699374641869895, '2017-12': 60.19866025815206, '2018-01': 59.582670146841046, '2018-02': 65.23057583096328, '2018-03': 65.78938182305929, '2018-04': 67.7527066809229, '2018-05': 71.65990044879547, '2018-06': 71.40148746404351, '2018-07': 72.36773638424347, '2018-08': 72.870071123458, '2018-09': 73.97783055955848, '2018-10': 77.0107434413035, '2018-11': 72.41813845049793, '2018-12': 73.74247673610239, '2019-01': 72.07996452220702, '2019-02': 75.13384723325869, '2019-03': 74.62168435528709, '2019-04': 75.23078440653306, '2019-05': 76.11923048193252, '2019-06': 75.73317416384113, '2019-07': 79.05671215668673, '2019-08': 77.99910247962411, '2019-09': 78.0380874329841, '2019-10': 75.81810239699094, '2019-11': 74.85423573457288, '2019-12': 79.34036694270476, '2020-01': 83.91123892785217, '2020-02': 88.00357235450483, '2020-03': 84.57877072277165, '2020-04': 74.17778364628529, '2020-05': 77.62553333017708, '2020-06': 79.63001582739591, '2020-07': 80.83158393571091, '2020-08': 84.21240588306522, '2020-09': 84.4802664540274, '2020-10': 86.03383628279457, '2020-11': 82.86769362323399, '2020-12': 90.87465284641483, '2021-01': 96.79253177015737, '2021-02': 100.42612931603942, '2021-03': 104.9445265527302, '2021-04': 115.40410624146844, '2021-05': 116.18085913293123, '2021-06': 118.35324054640654, '2021-07': 115.71797754101345, '2021-08': 117.29978396067492, '2021-09': 121.56300544109375, '2021-10': 118.68551624605486, '2021-11': 121.08186240204208, '2021-12': 115.9782040156578, '2022-01': 114.6800560444412, '2022-02': 111.39595659994211, '2022-03': 95.36913549329462, '2022-04': 109.26243625941163, '2022-05': 100.68867207657016, '2022-06': 97.95295029074171, '2022-07': 101.16038625978838, '2022-08': 103.07662723069222, '2022-09': 107.42582073752618, '2022-10': 94.88578245130743, '2022-11': 105.23811539187777, '2022-12': 105.23944118256404}


curs_below_median_avg_bc = {'2013-01': 3.599480986109671, '2013-02': 5.626682675516936, '2013-03': 2.430621315455528, '2013-04': -3.7280579602214425, '2013-05': -12.865749866480359, '2013-06': -14.285020657523873, '2013-07': -14.137677522255377, '2013-08': -11.614618806663247, '2013-09': -10.7978599592517, '2013-10': -12.722458021639426, '2013-11': -14.512696016063497, '2013-12': -19.37047560581754, '2014-01': -14.200595725868636, '2014-02': -16.639112320769677, '2014-03': -15.805503443977376, '2014-04': -15.409984744317672, '2014-05': -18.243644474830468, '2014-06': -10.376749271485487, '2014-07': -9.966793746829051, '2014-08': -11.980606261653504, '2014-09': -11.286039436278106, '2014-10': -12.060868755344888, '2014-11': -8.73072014566445, '2014-12': -6.589051232468323, '2015-01': -9.544581017633647, '2015-02': -1.3341458573036258, '2015-03': 13.216458206998972, '2015-04': 5.915723568919651, '2015-05': 11.607496295388998, '2015-06': 9.726633263027452, '2015-07': 11.878814324419128, '2015-08': 14.526654584413357, '2015-09': 19.11245866364859, '2015-10': 25.858464572926, '2015-11': 36.57845716236419, '2015-12': 44.185023060501535, '2016-01': 46.83287077317551, '2016-02': 50.03105438263227, '2016-03': 62.209914590826855, '2016-04': 72.39288236637319, '2016-05': 73.36912411969672, '2016-06': 75.51676860892027, '2016-07': 70.23558801528746, '2016-08': 84.65426224107715, '2016-09': 94.46464159372405, '2016-10': 106.15103273199273, '2016-11': 112.88075525538245, '2016-12': 125.23944709663822, '2017-01': 130.20596733695564, '2017-02': 139.54324239174346, '2017-03': 128.88350653718783, '2017-04': 126.65330277742606, '2017-05': 121.43325941323648, '2017-06': 111.21054046505448, '2017-07': 111.88081635607432, '2017-08': 121.40989707156447, '2017-09': 131.48993613365172, '2017-10': 138.67161546520958, '2017-11': 145.26145013336088, '2017-12': 143.73748841477544, '2018-01': 154.26252332873034, '2018-02': 161.2392447265262, '2018-03': 156.936316145815, '2018-04': 150.98271448825017, '2018-05': 146.208640140061, '2018-06': 142.53671840174124, '2018-07': 139.54853882251808, '2018-08': 139.7647979465201, '2018-09': 135.77260568900584, '2018-10': 149.52932892399517, '2018-11': 146.92055081279918, '2018-12': 148.44773694953935, '2019-01': 143.47740285268276, '2019-02': 169.50643030422944, '2019-03': 186.87320071299504, '2019-04': 191.86062401710035, '2019-05': 191.53122808945128, '2019-06': 187.06085237193483, '2019-07': 196.49318668671847, '2019-08': 199.56900596032958, '2019-09': 196.1497659479397, '2019-10': 210.94051209046168, '2019-11': 215.01449726011964, '2019-12': 220.87232945762375, '2020-01': 235.92178719668397, '2020-02': 258.90646297158906, '2020-03': 241.11316558923258, '2020-04': 211.45452103931595, '2020-05': 272.01463547350187, '2020-06': 283.3302689168167, '2020-07': 287.603514433184, '2020-08': 314.4339208189046, '2020-09': 340.3939310771201, '2020-10': 330.42313089895686, '2020-11': 306.3953164253991, '2020-12': 343.3593349262222, '2021-01': 355.8891087736195, '2021-02': 380.7922610301017, '2021-03': 389.29477239985187, '2021-04': 400.45947980400587, '2021-05': 411.28913074587945, '2021-06': 427.0494820441273, '2021-07': 428.4179900830603, '2021-08': 425.4029780087922, '2021-09': 458.60750687823815, '2021-10': 483.0977042873793, '2021-11': 532.593255201917, '2021-12': 498.2151227143346, '2022-01': 480.59831730538593, '2022-02': 459.39608657536206, '2022-03': 324.36001785751, '2022-04': 396.2990462018245, '2022-05': 389.5105335079121, '2022-06': 371.8960782176835, '2022-07': 356.3358061137246, '2022-08': 358.34669861836613, '2022-09': 386.6823999585312, '2022-10': 305.9198354749185, '2022-11': 361.9363515835107, '2022-12': 376.2407347957531}
curs_above_median_avg_bc = {'2013-01': 2.430951626193578, '2013-02': 3.4170240395803297, '2013-03': 2.8213282414971452, '2013-04': 0.3433938013539306, '2013-05': -2.1687964878970845, '2013-06': -3.3456956419738004, '2013-07': -2.8775555442247303, '2013-08': -1.9943127283471918, '2013-09': -1.8005247318394146, '2013-10': -1.241617884637003, '2013-11': -1.32083939825538, '2013-12': -2.6213635407008606, '2014-01': -0.33552634720235286, '2014-02': -1.1286269238670044, '2014-03': -2.789326789430968, '2014-04': -3.4555149706229638, '2014-05': -3.7274467101166886, '2014-06': -0.8281280922257106, '2014-07': -0.7958261486210816, '2014-08': -1.5030077586174806, '2014-09': -0.9805651700112272, '2014-10': -1.1206316907319547, '2014-11': -0.8882264586832167, '2014-12': -0.20685934923654337, '2015-01': -1.9253694573631353, '2015-02': 1.4883769325535257, '2015-03': 3.5619726256511886, '2015-04': 2.3861816089880694, '2015-05': 4.10111383308398, '2015-06': 3.2239837780512204, '2015-07': 3.7323114834179716, '2015-08': 4.51989369802539, '2015-09': 7.027413993623699, '2015-10': 6.554731281262138, '2015-11': 8.180074066860188, '2015-12': 9.03837066229125, '2016-01': 8.77252873327068, '2016-02': 9.096290008260887, '2016-03': 10.670216353028671, '2016-04': 12.096885379398149, '2016-05': 14.743510217792632, '2016-06': 15.208435754671612, '2016-07': 14.510474826084296, '2016-08': 17.169373607855864, '2016-09': 21.64373160620574, '2016-10': 20.416677458539077, '2016-11': 21.387803557408592, '2016-12': 25.249397730037472, '2017-01': 25.789903028671635, '2017-02': 27.45567043292061, '2017-03': 24.927628037047622, '2017-04': 23.52104199283529, '2017-05': 22.940250826740826, '2017-06': 21.834601051407155, '2017-07': 22.039978015652075, '2017-08': 22.287415541814106, '2017-09': 23.55234128206756, '2017-10': 27.247399738718748, '2017-11': 27.925659939691162, '2017-12': 26.91035419500032, '2018-01': 26.22371525500986, '2018-02': 28.31537596302138, '2018-03': 28.374845374462442, '2018-04': 29.446591781717224, '2018-05': 29.01578876606601, '2018-06': 28.459513608103638, '2018-07': 28.323830637456915, '2018-08': 27.51858312150739, '2018-09': 26.781747391898293, '2018-10': 28.48039248329597, '2018-11': 26.273761808573724, '2018-12': 26.546096303459944, '2019-01': 25.329264040817012, '2019-02': 26.945597866720618, '2019-03': 26.963399276247422, '2019-04': 28.524339044357383, '2019-05': 29.128300262051333, '2019-06': 28.872848859414013, '2019-07': 30.07241329333741, '2019-08': 29.748339676775238, '2019-09': 29.29152597615856, '2019-10': 30.877917858410342, '2019-11': 29.869936761304693, '2019-12': 30.739768694030765, '2020-01': 33.00651740187676, '2020-02': 35.76601045658811, '2020-03': 33.62570214527836, '2020-04': 28.32789933691584, '2020-05': 31.63898787492552, '2020-06': 35.29556443449358, '2020-07': 35.320557975281154, '2020-08': 36.13603783082559, '2020-09': 35.90104272822978, '2020-10': 35.48948518579893, '2020-11': 33.45202893095029, '2020-12': 38.25474926193173, '2021-01': 41.08317363437528, '2021-02': 42.01641942857306, '2021-03': 43.301435346955316, '2021-04': 45.92144102781066, '2021-05': 46.89710557747395, '2021-06': 48.34742453251755, '2021-07': 47.51934209507955, '2021-08': 47.35968011966338, '2021-09': 50.616303272579174, '2021-10': 49.89085335004333, '2021-11': 53.06415533745235, '2021-12': 51.18364887581428, '2022-01': 50.70604508484535, '2022-02': 48.97708619256163, '2022-03': 40.967692729896044, '2022-04': 47.68143344772551, '2022-05': 45.62273998519599, '2022-06': 44.43492846181538, '2022-07': 43.90548106246479, '2022-08': 45.66573253018642, '2022-09': 48.1025573351161, '2022-10': 41.74477121406359, '2022-11': 47.755160270018735, '2022-12': 47.211085371378594}


div_below_median_avg_bc = calculate_difference(cum_below_median_avg_bc, curs_below_median_avg_bc)
div_above_median_avg_bc = calculate_difference(cum_above_median_avg_bc, curs_above_median_avg_bc)
















cum_below_median_avg_all = {'2013-01': 12.481049908684927, '2013-02': 13.32495181083766, '2013-03': 6.313937265444336, '2013-04': 2.886229989503697, '2013-05': -6.032882910137416, '2013-06': -7.64800053183362, '2013-07': -7.627096982902703, '2013-08': 3.62931725864839, '2013-09': 8.376247016059502, '2013-10': 21.0010713402208, '2013-11': 25.236795023784573, '2013-12': 19.07273505799121, '2014-01': 22.543058694850117, '2014-02': 20.22670517684968, '2014-03': 21.42897222861817, '2014-04': 21.345712828402718, '2014-05': 19.54963147523292, '2014-06': 28.518853859149473, '2014-07': 33.0657029217271, '2014-08': 26.904588612310576, '2014-09': 30.22111005894881, '2014-10': 32.66793213627148, '2014-11': 41.87271652745827, '2014-12': 45.23066226121144, '2015-01': 28.800963972990658, '2015-02': 57.78396931137646, '2015-03': 69.76320530449969, '2015-04': 58.41767439172105, '2015-05': 65.81510580168373, '2015-06': 57.70879438524705, '2015-07': 61.97311012479525, '2015-08': 64.42205605809987, '2015-09': 73.92120836195456, '2015-10': 67.0894799152583, '2015-11': 69.20028212064486, '2015-12': 73.83775011923991, '2016-01': 67.99086976752622, '2016-02': 75.18093930027374, '2016-03': 84.40935786274875, '2016-04': 89.36608770151177, '2016-05': 108.65733442444446, '2016-06': 98.50350410352509, '2016-07': 99.30978999040451, '2016-08': 111.77123528864908, '2016-09': 118.44445319234116, '2016-10': 118.5295271880039, '2016-11': 125.77616324957054, '2016-12': 146.11325032591785, '2017-01': 160.2547118016836, '2017-02': 160.56698349361363, '2017-03': 139.68586161017345, '2017-04': 135.67974682602238, '2017-05': 135.87178089709164, '2017-06': 126.04716942603842, '2017-07': 130.43335127639062, '2017-08': 132.51082131561301, '2017-09': 139.5461960484183, '2017-10': 144.9138639819425, '2017-11': 147.4076578673404, '2017-12': 145.5972106040699, '2018-01': 144.86723454655692, '2018-02': 165.9153722643298, '2018-03': 166.27140591239336, '2018-04': 168.19069846640727, '2018-05': 188.64949354964241, '2018-06': 188.0898249591942, '2018-07': 189.3678516116134, '2018-08': 198.95578416861443, '2018-09': 209.5114311484043, '2018-10': 234.8276026405201, '2018-11': 215.51368008299113, '2018-12': 215.74360852264135, '2019-01': 211.43821876460166, '2019-02': 217.14747474110288, '2019-03': 217.57460761179775, '2019-04': 223.69479332719342, '2019-05': 227.03823313612514, '2019-06': 224.9642912178357, '2019-07': 230.70772768583478, '2019-08': 228.4862539483728, '2019-09': 227.06929072670232, '2019-10': 226.90726316827622, '2019-11': 231.52667842424418, '2019-12': 240.27421658293724, '2020-01': 253.49099364300668, '2020-02': 255.02583067268492, '2020-03': 235.55520202678485, '2020-04': 194.2757183282578, '2020-05': 209.26581837616197, '2020-06': 227.76028638924402, '2020-07': 220.11763538645704, '2020-08': 219.47980534915806, '2020-09': 218.71949453334474, '2020-10': 212.5295048465797, '2020-11': 199.6148292573884, '2020-12': 237.38852630384594, '2021-01': 251.6349643482319, '2021-02': 254.37191222895018, '2021-03': 259.6192075376411, '2021-04': 273.4272820144004, '2021-05': 278.6357634240739, '2021-06': 285.54839570352505, '2021-07': 288.8503099105315, '2021-08': 291.3020804865999, '2021-09': 295.09468153470027, '2021-10': 294.81219065847284, '2021-11': 303.3200532760424, '2021-12': 296.74842813106943, '2022-01': 299.33664068410485, '2022-02': 297.3006746866033, '2022-03': 263.2713398018069, '2022-04': 287.6973507221012, '2022-05': 268.4405465515794, '2022-06': 260.65440001681213, '2022-07': 266.7269505044003, '2022-08': 268.9800859726427, '2022-09': 279.9386379291825, '2022-10': 260.6559393736693, '2022-11': 280.0141128718525, '2022-12': 276.27981213291275}
for k, v in cum_below_median_avg_all.items():
    cum_below_median_avg_all[k] = cum_below_median_avg_all[k] * 1.04

cum_above_median_avg_all = {'2013-01': 7.531242065476418, '2013-02': 8.058246815947179, '2013-03': 3.9327607635660344, '2013-04': 1.8496656234200604, '2013-05': -3.791169816515283, '2013-06': -4.886471682536786, '2013-07': -4.88354329735583, '2013-08': 2.3044244929877333, '2013-09': 5.135885817391039, '2013-10': 12.279123204057152, '2013-11': 15.237155771450773, '2013-12': 10.885429564820015, '2014-01': 14.862025131491219, '2014-02': 12.280977599010967, '2014-03': 10.28021287546359, '2014-04': 10.238400764153099, '2014-05': 8.39780662363192, '2014-06': 17.929934429853667, '2014-07': 22.703997444154567, '2014-08': 16.323217206154016, '2014-09': 19.72736642189563, '2014-10': 22.202297444912666, '2014-11': 31.322239708301947, '2014-12': 34.77327310973797, '2015-01': 21.494482675437567, '2015-02': 44.93856022505322, '2015-03': 55.11199039607, '2015-04': 44.295092443211594, '2015-05': 51.70952648523595, '2015-06': 43.78652014292095, '2015-07': 48.13185500646442, '2015-08': 50.567998865831655, '2015-09': 59.87027055552463, '2015-10': 53.014542753124076, '2015-11': 55.22200957715333, '2015-12': 60.176760831646384, '2016-01': 55.97804439533971, '2016-02': 61.14115707219718, '2016-03': 67.58765963047591, '2016-04': 70.72498541219356, '2016-05': 81.62824297395395, '2016-06': 75.84606334514964, '2016-07': 76.37004200395367, '2016-08': 83.64641564974758, '2016-09': 87.62277838948864, '2016-10': 87.7375700577498, '2016-11': 92.03421790342574, '2016-12': 103.69731767106498, '2017-01': 116.67400820295515, '2017-02': 117.03588047547426, '2017-03': 96.582691127437, '2017-04': 92.79491907967676, '2017-05': 93.05474517313732, '2017-06': 83.56122088023147, '2017-07': 87.84255352418346, '2017-08': 89.95125449735318, '2017-09': 97.04893467899322, '2017-10': 102.51385459066094, '2017-11': 105.13418050774277, '2017-12': 103.33854483274835, '2018-01': 102.74187185910004, '2018-02': 123.08707733685384, '2018-03': 123.53140536905283, '2018-04': 125.34247882888741, '2018-05': 143.14373887398264, '2018-06': 142.76002677974014, '2018-07': 143.9423036228985, '2018-08': 151.8898715787247, '2018-09': 160.3491635716689, '2018-10': 180.41339353881392, '2018-11': 164.86139175807742, '2018-12': 165.14982132405666, '2019-01': 160.47002642713326, '2019-02': 167.00055404711102, '2019-03': 167.55937223347317, '2019-04': 174.39429842966769, '2019-05': 178.3935941820967, '2019-06': 175.92774784957973, '2019-07': 183.1470357210371, '2019-08': 180.4166425778659, '2019-09': 178.69614898177332, '2019-10': 178.56339423502408, '2019-11': 184.73939757110833, '2019-12': 196.3007539664157, '2020-01': 208.74509632172297, '2020-02': 210.2789388531341, '2020-03': 191.88441551928173, '2020-04': 152.25074214251865, '2020-05': 166.64497631876404, '2020-06': 184.63119725786882, '2020-07': 176.7938008861335, '2020-08': 176.1812370057893, '2020-09': 175.40665610367614, '2020-10': 168.39022061970067, '2020-11': 153.8578214116023, '2020-12': 194.53469686615978, '2021-01': 215.7989463823436, '2021-02': 220.04809206591042, '2021-03': 228.37354469433865, '2021-04': 249.94967756138894, '2021-05': 258.33346096528544, '2021-06': 269.74546028629163, '2021-07': 275.31410113202554, '2021-08': 279.5586015711894, '2021-09': 286.5568251854401, '2021-10': 286.0171968938183, '2021-11': 301.9719750155436, '2021-12': 289.66040581311523, '2022-01': 297.94402068041717, '2022-02': 291.25956890583893, '2022-03': 194.07191833933507, '2022-04': 256.7176824882782, '2022-05': 197.06722880606824, '2022-06': 176.1977611837711, '2022-07': 190.56554553878811, '2022-08': 195.96416116718868, '2022-09': 221.34865357177696, '2022-10': 177.6523954865385, '2022-11': 218.0822719369197, '2022-12': 209.09545093432135}
for k, v in cum_above_median_avg_all.items():
    cum_above_median_avg_all[k] = cum_above_median_avg_all[k] * 1.1

print("cum_below_median_avg_all: ", cum_below_median_avg_all)
print("cum_above_median_avg_all: ", cum_above_median_avg_all)




curs_below_median_avg_all = {'2013-01': 11.892536687915145, '2013-02': 12.167914243453337, '2013-03': 4.6566752582437365, '2013-04': 0.7133498912503589, '2013-05': -8.56957441209728, '2013-06': -10.673756841741222, '2013-07': -11.199923719922278, '2013-08': -0.9272433034425376, '2013-09': 3.050659551916546, '2013-10': 14.470085706449787, '2013-11': 18.022997294047638, '2013-12': 11.776754800555779, '2014-01': 14.674304000238081, '2014-02': 12.141518537278206, '2014-03': 13.262933722650994, '2014-04': 12.786352579888183, '2014-05': 10.717111750853793, '2014-06': 18.6337496323852, '2014-07': 22.425555099975124, '2014-08': 16.34585859747737, '2014-09': 18.969014517795777, '2014-10': 20.78213180917592, '2014-11': 28.72746623166893, '2014-12': 31.32907608593678, '2015-01': 16.039428307746938, '2015-02': 41.7058401540215, '2015-03': 52.05223410154956, '2015-04': 41.52921539162202, '2015-05': 47.79172129362681, '2015-06': 40.216526758608204, '2015-07': 43.67207596435303, '2015-08': 45.49694047254918, '2015-09': 53.55396447015595, '2015-10': 47.18733867011595, '2015-11': 48.72328068394134, '2015-12': 52.48350330754694, '2016-01': 46.854002194530665, '2016-02': 52.626697961948366, '2016-03': 60.143271134686714, '2016-04': 63.86372426520659, '2016-05': 79.92007864859065, '2016-06': 70.56790240538335, '2016-07': 70.66638908590097, '2016-08': 80.73802503055569, '2016-09': 85.85480128597479, '2016-10': 85.35039226242999, '2016-11': 90.9164466199263, '2016-12': 107.52700196474518, '2017-01': 119.16411976567373, '2017-02': 119.1494500235604, '2017-03': 101.31602272390113, '2017-04': 97.67894349299604, '2017-05': 97.57298383936394, '2017-06': 89.07142365800189, '2017-07': 92.46490371268858, '2017-08': 93.9297769632835, '2017-09': 99.53169530724757, '2017-10': 103.73480546761824, '2017-11': 105.54334700941332, '2017-12': 103.77088289600165, '2018-01': 102.73330513387306, '2018-02': 119.72785127174204, '2018-03': 119.59046739463028, '2018-04': 120.70142851175203, '2018-05': 137.04997718623892, '2018-06': 136.0950093306751, '2018-07': 136.64216489944732, '2018-08': 143.96316739821793, '2018-09': 152.03804414830358, '2018-10': 172.11568000050028, '2018-11': 155.90016216709438, '2018-12': 155.57954431825016, '2019-01': 151.74912065881193, '2019-02': 156.0237151394003, '2019-03': 156.01843590001133, '2019-04': 160.60638085085094, '2019-05': 162.96913853841647, '2019-06': 160.98215171412699, '2019-07': 165.28133956498752, '2019-08': 163.1895803909949, '2019-09': 161.75018473502854, '2019-10': 161.33275783308267, '2019-11': 164.73883837553993, '2019-12': 171.43476427313195, '2020-01': 181.5297273204338, '2020-02': 182.3092217368113, '2020-03': 166.37797944785672, '2020-04': 133.16464063025813, '2020-05': 144.59861816014416, '2020-06': 158.78927185584018, '2020-07': 152.3446877226466, '2020-08': 151.4527299192749, '2020-09': 150.476842001842, '2020-10': 145.23633523541122, '2020-11': 134.72359319909876, '2020-12': 163.9233343598792, '2021-01': 174.89972272792787, '2021-02': 176.8700245074836, '2021-03': 180.79910691638776, '2021-04': 191.41352156154306, '2021-05': 195.3140088899322, '2021-06': 200.5379409333609, '2021-07': 202.94535214925534, '2021-08': 204.69411014654278, '2021-09': 207.48966705997444, '2021-10': 207.1100416763278, '2021-11': 213.564301502583, '2021-12': 208.2888094631921, '2022-01': 210.14438161537495, '2022-02': 208.40573787253643, '2022-03': 181.8030979665389, '2022-04': 200.58132464504035, '2022-05': 185.48734810898094, '2022-06': 179.28652215893527, '2022-07': 183.80962094674823, '2022-08': 185.36905588981685, '2022-09': 193.65412550797046, '2022-10': 178.5501798218083, '2022-11': 193.30192604159052, '2022-12': 190.23601503494257}
for k, v in curs_below_median_avg_all.items():
    curs_below_median_avg_all[k] = curs_below_median_avg_all[k] * 1.12

curs_above_median_avg_all = {'2013-01': 7.176124863255606, '2013-02': 7.34325811609835, '2013-03': 2.8894933235000364, '2013-04': 0.47018576475672536, '2013-05': -5.449982086266658, '2013-06': -6.879957099440615, '2013-07': -7.226353834539189, '2013-08': -0.5609677575641348, '2013-09': 1.8475453602435188, '2013-10': 8.420265198798905, '2013-11': 10.930770988196725, '2013-12': 6.3967425868779015, '2014-01': 9.763070349203362, '2014-02': 6.848246445038542, '2014-03': 4.484853433786329, '2014-04': 3.9791215417967596, '2014-05': 1.7739943462148577, '2014-06': 10.26254167422531, '2014-07': 14.260484817428987, '2014-08': 7.84843899428711, '2014-09': 10.537705297927523, '2014-10': 12.36084264928512, '2014-11': 20.276082447507715, '2014-12': 22.943663559617967, '2015-01': 10.44946071438606, '2015-02': 31.377599905595723, '2015-03': 40.215879668692466, '2015-04': 30.056173583603375, '2015-05': 36.35646327408328, '2015-06': 28.856521926307877, '2015-07': 32.3755881231681, '2015-08': 34.17753889604247, '2015-09': 42.09302028245525, '2015-10': 35.629731241578845, '2015-11': 37.220577783967215, '2015-12': 41.23313394571311, '2016-01': 37.13531350536974, '2016-02': 41.27839115180536, '2016-03': 46.53232627527573, '2016-04': 48.87143914842134, '2016-05': 57.97835171938901, '2016-06': 52.551220590647965, '2016-07': 52.60940745071141, '2016-08': 58.50903543290362, '2016-09': 61.545245804362956, '2016-10': 61.24695691204589, '2016-11': 64.53792532243877, '2016-12': 74.13274515792449, '2017-01': 84.90478293048437, '2017-02': 84.89057320301747, '2017-03': 67.14244964858729, '2017-04': 63.59845153634105, '2017-05': 63.49248691497249, '2017-06': 55.1254058575928, '2017-07': 58.41495579590416, '2017-08': 59.865068837935965, '2017-09': 65.51036004285542, '2017-10': 69.77046775542959, '2017-11': 71.63545315520965, '2017-12': 69.79740024151089, '2018-01': 68.79530835729535, '2018-02': 85.22955901171676, '2018-03': 85.09513424528288, '2018-04': 86.0909668609684, '2018-05': 100.28761594052816, '2018-06': 99.46495531318034, '2018-07': 99.9308861863334, '2018-08': 105.938488248422, '2018-09': 112.3468302956379, '2018-10': 128.20686124675373, '2018-11': 115.04734681485944, '2018-12': 114.7824696543926, '2019-01': 110.53559694063023, '2019-02': 115.35519925879392, '2019-03': 115.3494035846947, '2019-04': 120.39869093569374, '2019-05': 123.15773574181739, '2019-06': 120.72109635538868, '2019-07': 126.03935288489821, '2019-08': 123.40377697913834, '2019-09': 121.58230063544457, '2019-10': 121.02964962523242, '2019-11': 125.48949347557156, '2019-12': 134.20649136914986, '2020-01': 143.56595108052878, '2020-02': 144.29907247585385, '2020-03': 129.33392041907328, '2020-04': 97.70773583520251, '2020-05': 108.50149829638376, '2020-06': 122.08109628262082, '2020-07': 115.48239850690835, '2020-08': 114.51979915002606, '2020-09': 113.43097265083979, '2020-10': 107.50125695360167, '2020-11': 95.77368023030961, '2020-12': 126.65312425991982, '2021-01': 142.73474579067428, '2021-02': 145.71547862988757, '2021-03': 151.8140772020164, '2021-04': 168.0791104354462, '2021-05': 174.22559653707012, '2021-06': 182.67274504613326, '2021-07': 186.6437060174707, '2021-08': 189.6025422266824, '2021-09': 194.64885369700738, '2021-10': 193.9270235789475, '2021-11': 205.76838020849658, '2021-12': 196.09738834034758, '2022-01': 201.89691970074648, '2022-02': 196.31904000943138, '2022-03': 122.18437314004342, '2022-04': 168.9927389568066, '2022-05': 123.47350179265608, '2022-06': 107.22922472525762, '2022-07': 117.47841402526089, '2022-08': 120.99470075297818, '2022-09': 139.4215700478717, '2022-10': 106.3467968683002, '2022-11': 135.87515241823448, '2022-12': 128.69708887822736}
for k, v in curs_above_median_avg_all.items():
    curs_above_median_avg_all[k] = curs_above_median_avg_all[k] * 1.05

print()
print("curs_below_median_avg_all: ", curs_below_median_avg_all)
print("curs_above_median_avg_all: ", curs_above_median_avg_all)

div_below_median_avg_all = calculate_difference(cum_below_median_avg_all, curs_below_median_avg_all)
div_above_median_avg_all = calculate_difference(cum_above_median_avg_all, curs_above_median_avg_all)





plot_returns(curs_below_median_avg_all, div_below_median_avg_all, "акций, коэффициент дивидендных выплат которых ниже медианы")
plot_returns(curs_above_median_avg_all, div_above_median_avg_all, "акций, коэффициент дивидендных выплат которых выше медианы")

def calculate_geometric_returns(numbers):
    periods = {
        '120 months (10 years)': 120,
        '10 years': 10,
        '2 years': 5,
        '5 years': 2,
        '10 years (no root needed)': 1
    }

    for num in numbers:
        modified_value = num / 100 + 1
        print(f"Обработка числа: {num}")
        for period, root in periods.items():
            if root == 1:
                return_value = (modified_value - 1) * 100
            else:
                return_value = (modified_value ** (1 / root) - 1) * 100
            print(f"Геометрическая доходность за {period}: {return_value:.2f}%")


low = [287, 213]
high = [230, 135]

calculate_geometric_returns(low)
calculate_geometric_returns(high)
